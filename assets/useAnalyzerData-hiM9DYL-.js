import{r}from"./index-DV0hRhEn.js";const g="https://chrome-ext-api.dev-joongi.workers.dev";function E(){const[e,s]=r.useState(null);return r.useEffect(()=>{try{const n=window.location.hash.slice(1);if(!n)return;const t=decodeURIComponent(n),o=JSON.parse(t);o.username&&o.profile&&(s(o),history.replaceState(null,"",window.location.pathname))}catch{}},[]),e}function R(){const[e,s]=r.useState(null),[n,t]=r.useState(!1),[o,i]=r.useState(null),p=r.useCallback(async(u,h)=>{if(!u.trim()){i("바이오가 비어있습니다");return}t(!0),i(null);try{const f=`인스타그램 인플루언서의 바이오(설명란)를 분석하여 카테고리를 분류해주세요.

바이오: "${u.replace(/[\n\r]+/g," ").replace(/"/g,"'").substring(0,500)}"
계정명: ${h}

분류 기준:
1. 대분류: 해당 계정의 가장 큰 산업군 또는 라이프스타일 영역
2. 중분류: 대분류 안에서 더 구체적인 타겟이나 콘텐츠의 성격

규칙:
- 대분류는 반드시 1개만 선택 (가장 핵심적인 것)
- 중분류는 1~3개 선택 가능
- 짧고 명확한 한글 키워드로 작성 (2~4글자)
- 바이오에서 명확히 파악되는 것만 분류

반드시 아래 JSON 형식으로만 응답하세요. 설명 없이 JSON만 출력:
{"대": "키워드", "중": ["키워드1", "키워드2"]}`,c=await fetch(g+"/api/groq",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"llama-3.3-70b-versatile",messages:[{role:"user",content:f}],temperature:.3,max_tokens:150})});if(!c.ok)throw new Error(`Groq API 오류 (${c.status})`);const l=(await c.json()).choices?.[0]?.message?.content,m=typeof l=="string"?l.trim():String(l??"");if(!m)throw new Error("LLM 응답이 비어있습니다");const S=m.match(/\{[\s\S]*\}/);if(!S)throw new Error("JSON 형식 응답 없음");const d=JSON.parse(S[0]),v={대:d.대||"",중:Array.isArray(d.중)?d.중:[]};s(v)}catch(a){i(a instanceof Error?a.message:"분류 실패")}finally{t(!1)}},[]);return{category:e,isClassifying:n,error:o,classify:p,setCategory:s}}function T(){const[e,s]=r.useState(!1),n=r.useCallback(async t=>{try{await navigator.clipboard.writeText(t),s(!0),setTimeout(()=>s(!1),2e3)}catch{const o=document.createElement("textarea");o.value=t,o.style.position="fixed",o.style.left="-9999px",document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),s(!0),setTimeout(()=>s(!1),2e3)}},[]);return{copied:e,copy:n}}function L(e,s){const n=s||{대:"",중:[]},t=new Date().toISOString().slice(0,10);return[e.username,e.profile.displayName||"",(e.profile.bio||"").replace(/\n/g," "),e.profile.externalLink||"",e.profile.profileLink,e.profile.followers,e.stats.avgViews,e.stats.maxViews,n.대||"",(n.중||[]).join(", "),e.stats.avgLikes||0,e.stats.maxLikes||0,e.stats.avgComments||0,e.stats.maxComments||0,e.stats.lastPostDate||"",t].join("	")}async function C(e){const s=await fetch(g+"/api/sheets/values?range="+encodeURIComponent(e),{headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error("시트 읽기 실패");return s.json()}async function y(e){const n=(await C("C:C")).values||[];for(let t=0;t<n.length;t++)if(n[t][0]===e)return t+1;return-1}function x(e,s){const n=[];for(let t=0;t<s.length;t++){const o=s[t],i=t<e.length?e[t]:"";o===""||o==="0"||o==null?n.push(i):n.push(o)}return n}function b(e,s){const n=s||{대:"",중:[]},t=new Date().toISOString().slice(0,10);return[e.username,e.profile.displayName||"",(e.profile.bio||"").replace(/\n/g," "),e.profile.externalLink||"",e.profile.profileLink,String(e.profile.followers),String(e.stats.avgViews),String(e.stats.maxViews),n.대||"",(n.중||[]).join(", "),String(e.stats.avgLikes||0),String(e.stats.maxLikes||0),String(e.stats.avgComments||0),String(e.stats.maxComments||0),e.stats.lastPostDate||"",t]}function N(){const[e,s]=r.useState(!1),[n,t]=r.useState(!1),[o,i]=r.useState(null),p=r.useCallback(async(u,h)=>{s(!0),i(null);try{const a=b(u,h),f=await y(u.username);if(f>0){const c="C"+f+":R"+f,l=(await C(c)).values?.[0]||[],m=x(l,a);if(!(await fetch(g+"/api/sheets/values?range="+encodeURIComponent(c),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({values:[m]})})).ok)throw new Error("시트 업데이트 실패")}else{const w=((await C("C:C")).values?.length||1)+4,l=[String(w),"FALSE",...a];if(!(await fetch(g+"/api/sheets/append?range="+encodeURIComponent("A:R"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({values:[l]})})).ok)throw new Error("시트 추가 실패")}t(!0),setTimeout(()=>t(!1),3e3)}catch(a){i(a instanceof Error?a.message:"저장 실패")}finally{s(!1)}},[]);return{isSaving:e,saved:n,error:o,save:p}}function O(e){return e?Number(e).toLocaleString("ko-KR"):"0"}export{N as a,T as b,L as c,E as d,O as f,R as u};
