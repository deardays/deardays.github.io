import{r as l,j as t}from"./index-DjKtMKa6.js";const j="https://chrome-ext-api.dev-joongi.workers.dev";function y(){const[e,n]=l.useState(null);return l.useEffect(()=>{try{const a=window.location.hash.slice(1);if(!a)return;const s=decodeURIComponent(a),r=JSON.parse(s);r.username&&r.profile&&(n(r),history.replaceState(null,"",window.location.pathname))}catch{}},[]),e}function C(){const[e,n]=l.useState(null),[a,s]=l.useState(!1),[r,i]=l.useState(null),f=l.useCallback(async(m,g)=>{if(!m.trim()){i("ë°”ì´ì˜¤ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤");return}s(!0),i(null);try{const x=`ì¸ìŠ¤íƒ€ê·¸ë¨ ì¸í”Œë£¨ì–¸ì„œì˜ ë°”ì´ì˜¤(ì„¤ëª…ë€)ë¥¼ ë¶„ì„í•˜ì—¬ ì¹´í…Œê³ ë¦¬ë¥¼ ë¶„ë¥˜í•´ì£¼ì„¸ìš”.

ë°”ì´ì˜¤: "${m.replace(/[\n\r]+/g," ").replace(/"/g,"'").substring(0,500)}"
ê³„ì •ëª…: ${g}

ë¶„ë¥˜ ê¸°ì¤€:
1. ëŒ€ë¶„ë¥˜: í•´ë‹¹ ê³„ì •ì˜ ê°€ì¥ í° ì‚°ì—…êµ° ë˜ëŠ” ë¼ì´í”„ìŠ¤íƒ€ì¼ ì˜ì—­
2. ì¤‘ë¶„ë¥˜: ëŒ€ë¶„ë¥˜ ì•ˆì—ì„œ ë” êµ¬ì²´ì ì¸ íƒ€ê²Ÿì´ë‚˜ ì½˜í…ì¸ ì˜ ì„±ê²©

ê·œì¹™:
- ëŒ€ë¶„ë¥˜ëŠ” ë°˜ë“œì‹œ 1ê°œë§Œ ì„ íƒ (ê°€ì¥ í•µì‹¬ì ì¸ ê²ƒ)
- ì¤‘ë¶„ë¥˜ëŠ” 1~3ê°œ ì„ íƒ ê°€ëŠ¥
- ì§§ê³  ëª…í™•í•œ í•œê¸€ í‚¤ì›Œë“œë¡œ ì‘ì„± (2~4ê¸€ì)
- ë°”ì´ì˜¤ì—ì„œ ëª…í™•íˆ íŒŒì•…ë˜ëŠ” ê²ƒë§Œ ë¶„ë¥˜

ë°˜ë“œì‹œ ì•„ë˜ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•˜ì„¸ìš”. ì„¤ëª… ì—†ì´ JSONë§Œ ì¶œë ¥:
{"ëŒ€": "í‚¤ì›Œë“œ", "ì¤‘": ["í‚¤ì›Œë“œ1", "í‚¤ì›Œë“œ2"]}`,c=await fetch(j+"/api/groq",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"llama-3.3-70b-versatile",messages:[{role:"user",content:x}],temperature:.3,max_tokens:150})});if(!c.ok)throw new Error(`Groq API ì˜¤ë¥˜ (${c.status})`);const d=(await c.json()).choices?.[0]?.message?.content,b=typeof d=="string"?d.trim():String(d??"");if(!b)throw new Error("LLM ì‘ë‹µì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤");const v=b.match(/\{[\s\S]*\}/);if(!v)throw new Error("JSON í˜•ì‹ ì‘ë‹µ ì—†ìŒ");const w=JSON.parse(v[0]),S={ëŒ€:w.ëŒ€||"",ì¤‘:Array.isArray(w.ì¤‘)?w.ì¤‘:[]};n(S)}catch(o){i(o instanceof Error?o.message:"ë¶„ë¥˜ ì‹¤íŒ¨")}finally{s(!1)}},[]);return{category:e,isClassifying:a,error:r,classify:f,setCategory:n}}function k(){const[e,n]=l.useState(!1),a=l.useCallback(async s=>{try{await navigator.clipboard.writeText(s),n(!0),setTimeout(()=>n(!1),2e3)}catch{const r=document.createElement("textarea");r.value=s,r.style.position="fixed",r.style.left="-9999px",document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),n(!0),setTimeout(()=>n(!1),2e3)}},[]);return{copied:e,copy:a}}function E(e,n){const a=n||{ëŒ€:"",ì¤‘:[]},s=new Date().toISOString().slice(0,10);return[e.username,e.profile.displayName||"",(e.profile.bio||"").replace(/\n/g," "),e.profile.externalLink||"",e.profile.profileLink,e.profile.followers,e.stats.avgViews,e.stats.maxViews,a.ëŒ€||"",(a.ì¤‘||[]).join(", "),e.stats.avgLikes||0,e.stats.maxLikes||0,e.stats.avgComments||0,e.stats.maxComments||0,e.stats.lastPostDate||"",s].join("	")}async function N(e){const n=await fetch(j+"/api/sheets/values?range="+encodeURIComponent(e),{headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error("ì‹œíŠ¸ ì½ê¸° ì‹¤íŒ¨");return n.json()}async function L(e){const a=(await N("C:C")).values||[];for(let s=0;s<a.length;s++)if(a[s][0]===e)return s+1;return-1}function P(e,n){const a=[];for(let s=0;s<n.length;s++){const r=n[s],i=s<e.length?e[s]:"";r===""||r==="0"||r==null?a.push(i):a.push(r)}return a}function R(e,n){const a=n||{ëŒ€:"",ì¤‘:[]},s=new Date().toISOString().slice(0,10);return[e.username,e.profile.displayName||"",(e.profile.bio||"").replace(/\n/g," "),e.profile.externalLink||"",e.profile.profileLink,String(e.profile.followers),String(e.stats.avgViews),String(e.stats.maxViews),a.ëŒ€||"",(a.ì¤‘||[]).join(", "),String(e.stats.avgLikes||0),String(e.stats.maxLikes||0),String(e.stats.avgComments||0),String(e.stats.maxComments||0),e.stats.lastPostDate||"",s]}function I(){const[e,n]=l.useState(!1),[a,s]=l.useState(!1),[r,i]=l.useState(null),f=l.useCallback(async(m,g)=>{n(!0),i(null);try{const o=R(m,g),x=await L(m.username);if(x>0){const c="C"+x+":R"+x,d=(await N(c)).values?.[0]||[],b=P(d,o);if(!(await fetch(j+"/api/sheets/values?range="+encodeURIComponent(c),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({values:[b]})})).ok)throw new Error("ì‹œíŠ¸ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨")}else{const p=((await N("C:C")).values?.length||1)+4,d=[String(p),"FALSE",...o];if(!(await fetch(j+"/api/sheets/append?range="+encodeURIComponent("A:R"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({values:[d]})})).ok)throw new Error("ì‹œíŠ¸ ì¶”ê°€ ì‹¤íŒ¨")}s(!0),setTimeout(()=>s(!1),3e3)}catch(o){i(o instanceof Error?o.message:"ì €ì¥ ì‹¤íŒ¨")}finally{n(!1)}},[]);return{isSaving:e,saved:a,error:r,save:f}}function h(e){return e?Number(e).toLocaleString("ko-KR"):"0"}function T({profile:e}){return t.jsxs("div",{className:"bg-admin-card border border-admin-border rounded-lg p-4",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[t.jsx("div",{className:"w-12 h-12 rounded-full bg-admin-border flex items-center justify-center text-lg",children:"@"}),t.jsxs("div",{children:[t.jsxs("h2",{className:"text-white font-semibold",children:["@",e.username]}),e.displayName&&t.jsx("p",{className:"text-admin-text text-sm",children:e.displayName})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-admin-text",children:"íŒ”ë¡œì›Œ"}),t.jsx("span",{className:"text-white ml-2 font-semibold",children:h(e.followers)})]}),e.externalLink&&t.jsxs("div",{className:"col-span-2",children:[t.jsx("span",{className:"text-admin-text",children:"ì™¸ë¶€ë§í¬"}),t.jsx("a",{href:e.externalLink,target:"_blank",rel:"noopener noreferrer",className:"text-admin-accent ml-2 text-xs break-all",children:e.externalLink})]})]}),e.bio&&t.jsx("p",{className:"mt-3 text-sm text-admin-text whitespace-pre-wrap",children:e.bio})]})}function D({stats:e,feedPosts:n,reels:a}){const s=n.filter(i=>!i.isPinned&&i.isDeal),r=a.filter(i=>!i.isPinned);return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"bg-admin-card border border-admin-border rounded-lg p-4",children:[t.jsxs("h3",{className:"text-white font-semibold text-sm mb-3",children:["í”¼ë“œ í†µê³„ (ê³µêµ¬ ",s.length,"ê°œ)"]}),s.length>0?t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsx(u,{label:"í‰ê·  ì¢‹ì•„ìš”",value:h(e.avgLikes)}),t.jsx(u,{label:"ìµœëŒ€ ì¢‹ì•„ìš”",value:h(e.maxLikes)}),t.jsx(u,{label:"í‰ê·  ëŒ“ê¸€",value:h(e.avgComments)}),t.jsx(u,{label:"ìµœëŒ€ ëŒ“ê¸€",value:h(e.maxComments)})]}):t.jsx("p",{className:"text-admin-text text-sm",children:"ê³µêµ¬ ê²Œì‹œë¬¼ ì—†ìŒ"}),e.lastPostDate&&t.jsxs("p",{className:"text-admin-text text-xs mt-2",children:["ìµœê·¼ ê²Œì‹œë¬¼: ",e.lastPostDate]})]}),t.jsxs("div",{className:"bg-admin-card border border-admin-border rounded-lg p-4",children:[t.jsxs("h3",{className:"text-white font-semibold text-sm mb-3",children:["ë¦´ìŠ¤ í†µê³„ (",r.length,"ê°œ)"]}),r.length>0?t.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[t.jsx(u,{label:"í‰ê·  ì¡°íšŒìˆ˜",value:h(e.avgViews)}),t.jsx(u,{label:"ìµœëŒ€ ì¡°íšŒìˆ˜",value:h(e.maxViews)})]}):t.jsx("p",{className:"text-admin-text text-sm",children:"ë¦´ìŠ¤ ì—†ìŒ"})]})]})}function u({label:e,value:n}){return t.jsxs("div",{children:[t.jsx("p",{className:"text-admin-text text-xs",children:e}),t.jsx("p",{className:"text-white font-semibold",children:n})]})}function O({payload:e}){const{copied:n,copy:a}=k(),{category:s,isClassifying:r,error:i,classify:f}=C(),{isSaving:m,saved:g,error:o,save:x}=I(),c=()=>{a(E(e,s))},p=()=>{f(e.profile.bio,e.username)},d=()=>{x(e,s)};return t.jsxs("div",{className:"space-y-3",children:[s&&t.jsxs("div",{className:"bg-admin-card border border-admin-border rounded-lg p-3",children:[t.jsx("p",{className:"text-xs text-admin-text mb-1",children:"AI ë¶„ë¥˜"}),t.jsxs("p",{className:"text-white text-sm",children:[t.jsx("span",{className:"text-admin-accent font-semibold",children:s.ëŒ€}),s.ì¤‘.length>0&&t.jsx("span",{className:"text-admin-text ml-2",children:s.ì¤‘.join(", ")})]})]}),i&&t.jsx("p",{className:"text-red-400 text-xs",children:i}),o&&t.jsx("p",{className:"text-red-400 text-xs",children:o}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:p,disabled:r,className:"flex-1 py-3 rounded-lg text-sm font-semibold bg-admin-card border border-admin-border text-white active:bg-admin-border disabled:opacity-50 min-h-[44px]",children:r?"ë¶„ë¥˜ ì¤‘...":"ë¶„ë¥˜"}),t.jsx("button",{onClick:c,className:"flex-1 py-3 rounded-lg text-sm font-semibold bg-admin-accent text-black active:opacity-80 min-h-[44px]",children:n?"ë³µì‚¬ë¨!":"ë³µì‚¬í•˜ê¸°"}),t.jsx("button",{onClick:d,disabled:m,className:"flex-1 py-3 rounded-lg text-sm font-semibold bg-admin-card border border-admin-border text-white active:bg-admin-border disabled:opacity-50 min-h-[44px]",children:m?"ì €ì¥ ì¤‘...":g?"âœ… ì €ì¥ë¨!":"ğŸ“Š ì‹œíŠ¸ì €ì¥"})]})]})}function J(){const e=y();return e?t.jsxs("div",{className:"min-h-screen bg-admin-bg text-white",children:[t.jsx("header",{className:"p-4 border-b border-admin-border",children:t.jsxs("div",{className:"max-w-lg mx-auto flex items-center justify-between",children:[t.jsx("h1",{className:"text-admin-accent text-xs font-semibold tracking-widest font-admin-mono",children:"IG ANALYZER"}),t.jsx("a",{href:"/admin/analyzer/setup",className:"text-xs text-admin-text",children:"ì„¤ì •"})]})}),t.jsxs("main",{className:"max-w-lg mx-auto p-4 space-y-4 pb-8",children:[t.jsx(T,{profile:e.profile}),t.jsx(D,{stats:e.stats,feedPosts:e.feedPosts,reels:e.reels}),t.jsx(O,{payload:e})]})]}):t.jsxs("div",{className:"min-h-screen bg-admin-bg text-white flex flex-col items-center justify-center p-6",children:[t.jsx("h1",{className:"text-xl font-semibold mb-4",children:"Instagram ì¸í”Œë£¨ì–¸ì„œ ë¶„ì„ê¸°"}),t.jsx("p",{className:"text-admin-text text-center text-sm mb-6",children:"ë¶ë§ˆí´ë¦¿ìœ¼ë¡œ Instagramì—ì„œ ë¶„ì„í•œ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."}),t.jsx("a",{href:"/admin/analyzer/setup",className:"px-6 py-3 bg-admin-accent text-black rounded-lg font-semibold text-sm",children:"ë¶ë§ˆí´ë¦¿ ì„¤ì •í•˜ê¸°"})]})}export{J as default};
