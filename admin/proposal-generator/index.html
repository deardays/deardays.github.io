<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎîîÏñ¥Îç∞Ïù¥Ï¶à Ï†úÏïàÏÑú ÏÉùÏÑ±Í∏∞</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Work+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* ÏûÖÎ†• Ìèº ÏòÅÏó≠ */
        .form-panel {
            width: 400px;
            background: #1a1a2e;
            color: #fff;
            padding: 30px;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .form-panel h1 {
            font-size: 20px;
            margin-bottom: 8px;
            color: #ffaf5f;
        }

        .form-panel .subtitle {
            font-size: 12px;
            color: #8c91a0;
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h3 {
            font-size: 13px;
            color: #ffaf5f;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #32323c;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            font-size: 11px;
            color: #8c91a0;
            margin-bottom: 6px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            background: #26262f;
            border: 1px solid #32323c;
            border-radius: 6px;
            color: #fff;
            font-size: 13px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ffaf5f;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }

        /* Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ïπ¥Îìú */
        .influencer-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .influencer-item {
            background: #26262f;
            border-radius: 8px;
            padding: 15px;
            position: relative;
        }

        .influencer-item .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #f09b82;
            cursor: pointer;
            font-size: 18px;
            line-height: 1;
        }

        .influencer-item .form-group {
            margin-bottom: 10px;
        }

        .influencer-item .form-group:last-child {
            margin-bottom: 0;
        }

        .influencer-row {
            display: flex;
            gap: 10px;
        }

        .influencer-row .form-group {
            flex: 1;
        }

        .add-influencer-btn {
            width: 100%;
            padding: 12px;
            background: transparent;
            border: 2px dashed #32323c;
            border-radius: 8px;
            color: #8c91a0;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-influencer-btn:hover {
            border-color: #ffaf5f;
            color: #ffaf5f;
        }

        /* Notion Ïó∞Îèô */
        .notion-search {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
        }

        .notion-search input {
            flex: 1;
        }

        .notion-search button {
            padding: 10px 14px;
            background: #82b4af;
            border: none;
            border-radius: 6px;
            color: #1a1a2e;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .notion-search button:hover {
            background: #9fc9c4;
        }

        .notion-search button:disabled {
            background: #32323c;
            color: #8c91a0;
            cursor: not-allowed;
        }

        .notion-status {
            font-size: 11px;
            padding: 8px 12px;
            border-radius: 6px;
            margin-bottom: 12px;
            display: none;
        }

        .notion-status.show {
            display: block;
        }

        .notion-status.loading {
            background: #ffaf5f20;
            color: #ffaf5f;
        }

        .notion-status.success {
            background: #82b4af20;
            color: #82b4af;
        }

        .notion-status.error {
            background: #f09b8220;
            color: #f09b82;
        }

        .fetch-btn {
            padding: 6px 10px;
            background: #82b4af;
            border: none;
            border-radius: 4px;
            color: #1a1a2e;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 8px;
        }

        .fetch-btn:hover {
            background: #9fc9c4;
        }

        /* Notion Í≤ÄÏÉâ */
        .notion-search {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .notion-search input {
            flex: 1;
            padding: 10px 12px;
            background: #26262f;
            border: 1px solid #32323c;
            border-radius: 6px;
            color: #fff;
            font-size: 13px;
        }

        .notion-search input:focus {
            outline: none;
            border-color: #ffaf5f;
        }

        .notion-search button {
            padding: 10px 16px;
            background: #ffaf5f;
            border: none;
            border-radius: 6px;
            color: #1a1a2e;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
        }

        .notion-search button:hover {
            background: #ffd28c;
        }

        .notion-search button:disabled {
            background: #32323c;
            color: #8c91a0;
            cursor: not-allowed;
        }

        .notion-status {
            font-size: 11px;
            color: #8c91a0;
            margin-bottom: 10px;
            padding: 8px 12px;
            background: #26262f;
            border-radius: 6px;
        }

        .notion-status.success {
            color: #82b4af;
            background: #82b4af15;
        }

        .notion-status.error {
            color: #f09b82;
            background: #f09b8215;
        }

        .api-config {
            margin-bottom: 15px;
            padding: 12px;
            background: #20202a;
            border-radius: 8px;
        }

        .api-config summary {
            font-size: 11px;
            color: #8c91a0;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .api-config input {
            width: 100%;
            padding: 8px 10px;
            background: #26262f;
            border: 1px solid #32323c;
            border-radius: 4px;
            color: #fff;
            font-size: 11px;
            margin-top: 8px;
        }

        /* Î≤ÑÌäº */
        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 14px 20px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #ffaf5f;
            color: #1a1a2e;
        }

        .btn-primary:hover {
            background: #ffd28c;
        }

        .btn-secondary {
            background: #32323c;
            color: #fff;
        }

        .btn-secondary:hover {
            background: #3d3d4a;
        }

        /* ÎØ∏Î¶¨Î≥¥Í∏∞ ÏòÅÏó≠ */
        .preview-panel {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
        }

        .preview-header {
            width: 100%;
            max-width: 210mm;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .preview-header h2 {
            font-size: 16px;
            color: #333;
        }

        .preview-actions {
            display: flex;
            gap: 10px;
        }

        .preview-actions button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: #fff;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .preview-actions button:hover {
            background: #f5f5f5;
        }

        .preview-frame {
            background: #fff;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        /* Ï†úÏïàÏÑú Ïä§ÌÉÄÏùº (ÎØ∏Î¶¨Î≥¥Í∏∞Ïö©) */
        .proposal-preview {
            /* Í∏∞Ï°¥ Ï†úÏïàÏÑú Ïä§ÌÉÄÏùº Í∑∏ÎåÄÎ°ú Ìè¨Ìï® */
        }

        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }
            .form-panel {
                width: 100%;
                max-height: none;
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
                flex-shrink: 0;
            }
            .preview-panel {
                padding: 10px;
                width: 100%;
                align-items: center;
            }
            .preview-header {
                display: none;
            }
            .preview-frame {
                width: 100%;
                overflow: hidden;
            }
            .proposal {
                transform-origin: top left;
            }
            .form-group input,
            .form-group textarea,
            .notion-search input {
                font-size: 16px;
            }
        }

        /* ========== Ï†úÏïàÏÑú Ïä§ÌÉÄÏùº (Ïù∏ÎùºÏù∏) ========== */
        .proposal {
            --bg-dark: #16161c;
            --bg-medium: #20202a;
            --card-bg: #26262f;
            --accent-amber: #ffaf5f;
            --accent-gold: #ffd28c;
            --text-white: #faf8f5;
            --text-muted: #8c91a0;
            --coral: #f09b82;
            --teal: #82b4af;
            --purple: #a89bc9;
            --border-radius: 10px;

            width: 210mm;
            height: 297mm;
            padding: 35px;
            position: relative;
            background: linear-gradient(180deg, var(--bg-dark) 0%, var(--bg-medium) 100%);
            color: var(--text-white);
            font-family: 'Noto Sans KR', sans-serif;
            overflow: hidden;
        }

        .proposal .top-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--accent-amber);
        }

        .proposal .corner-bracket {
            position: absolute;
            width: 35px;
            height: 35px;
        }
        .proposal .corner-bracket.top-left {
            top: 25px;
            left: 28px;
            border-top: 2px solid var(--accent-gold);
            border-left: 2px solid var(--accent-gold);
        }
        .proposal .corner-bracket.top-right {
            top: 25px;
            right: 28px;
            border-top: 2px solid var(--accent-gold);
            border-right: 2px solid var(--accent-gold);
        }
        .proposal .corner-bracket.bottom-right {
            bottom: 25px;
            right: 28px;
            border-bottom: 2px solid var(--accent-gold);
            border-right: 2px solid var(--accent-gold);
        }

        .proposal .header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 14px;
            padding-top: 25px;
        }
        .proposal .header span {
            font-family: 'Work Sans', sans-serif;
            font-size: 11px;
            font-weight: 300;
            color: var(--text-muted);
            letter-spacing: 1px;
        }

        .proposal .title-section {
            margin-bottom: 16px;
        }
        .proposal .title-section .accent-line {
            width: 70px;
            height: 3px;
            background: var(--accent-amber);
            margin-bottom: 10px;
        }
        .proposal .title-section h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 2px;
        }
        .proposal .title-section h2 {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent-amber);
            margin-bottom: 6px;
        }
        .proposal .title-section .subtitle {
            font-family: 'Work Sans', sans-serif;
            font-size: 11px;
            font-weight: 400;
            color: var(--text-muted);
            letter-spacing: 2px;
            margin-bottom: 8px;
        }
        .proposal .title-section .divider {
            width: 28px;
            height: 1px;
            background: var(--text-muted);
        }

        .proposal .product-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 14px 25px;
            margin-bottom: 18px;
            position: relative;
        }
        .proposal .product-card::before {
            content: '';
            position: absolute;
            left: 12px;
            top: 15px;
            bottom: 15px;
            width: 3px;
            background: var(--accent-amber);
            border-radius: 2px;
        }
        .proposal .product-info {
            padding-left: 15px;
        }
        .proposal .product-info .label {
            font-family: 'Work Sans', sans-serif;
            font-size: 10px;
            color: var(--text-muted);
            letter-spacing: 1px;
            margin-bottom: 6px;
        }
        .proposal .product-info h3 {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 6px;
        }
        .proposal .product-info .detail {
            font-size: 12px;
            color: var(--accent-gold);
            margin-bottom: 6px;
        }
        .proposal .product-info .company {
            font-size: 11px;
            color: var(--text-muted);
        }

        .proposal .section-header {
            margin-bottom: 14px;
        }
        .proposal .section-header .line {
            width: 50px;
            height: 1px;
            background: var(--text-muted);
            margin-bottom: 5px;
        }
        .proposal .section-header .eng {
            font-family: 'Work Sans', sans-serif;
            font-size: 9px;
            color: var(--text-muted);
            letter-spacing: 1px;
            margin-bottom: 2px;
        }
        .proposal .section-header h4 {
            font-size: 13px;
            font-weight: 700;
        }

        .proposal .influencer-section {
            margin-bottom: 16px;
        }
        .proposal .influencer-cards {
            display: flex;
            gap: 10px;
            margin-bottom: 6px;
        }
        .proposal .influencer-card {
            flex: 1;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 10px 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            text-align: center;
        }
        .proposal .influencer-card .avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
        }
        .proposal .influencer-card .avatar.coral { background: var(--coral); }
        .proposal .influencer-card .avatar.teal { background: var(--teal); }
        .proposal .influencer-card .avatar.purple { background: var(--purple); }
        .proposal .influencer-card .avatar.amber { background: var(--accent-amber); }
        .proposal .influencer-card .info h5 {
            font-size: 12px;
            font-weight: 700;
            margin-bottom: 3px;
        }
        .proposal .influencer-card .info .handle {
            font-size: 10px;
            color: var(--accent-amber);
            margin-bottom: 3px;
        }
        .proposal .influencer-card .info .stats {
            font-size: 9px;
            color: var(--text-muted);
            line-height: 1.5;
        }
        .proposal .influencer-note {
            font-size: 10px;
            color: var(--text-muted);
        }

        .proposal .promise-section {
            margin-bottom: 14px;
        }
        .proposal .promise-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .proposal .promise-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .proposal .promise-item .number {
            width: 20px;
            height: 20px;
            background: var(--accent-amber);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Work Sans', sans-serif;
            font-size: 11px;
            font-weight: 600;
            color: var(--bg-dark);
        }
        .proposal .promise-item .text {
            font-size: 11px;
            font-weight: 400;
        }

        .proposal .agency-section {
            border-top: 1px solid #32323c;
            padding-top: 12px;
            margin-bottom: 14px;
        }
        .proposal .agency-header {
            display: flex;
            align-items: baseline;
            gap: 12px;
            margin-bottom: 10px;
        }
        .proposal .agency-header h4 {
            font-family: 'Work Sans', sans-serif;
            font-size: 18px;
            font-weight: 700;
            color: var(--accent-amber);
        }
        .proposal .agency-header span {
            font-size: 11px;
            color: var(--text-muted);
        }
        .proposal .stats {
            display: flex;
            gap: 30px;
            align-items: flex-end;
        }
        .proposal .stat {
            flex: 1;
        }
        .proposal .stat .value {
            font-family: 'Work Sans', sans-serif;
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        .proposal .stat .label {
            font-size: 10px;
            color: var(--text-muted);
        }
        .proposal .stat.website .value {
            font-size: 12px;
            color: var(--accent-amber);
        }

        .proposal .contact-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 12px 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            margin-bottom: 12px;
        }
        .proposal .contact-card::before {
            content: '';
            position: absolute;
            left: 12px;
            top: 12px;
            bottom: 12px;
            width: 3px;
            background: var(--accent-amber);
            border-radius: 2px;
        }
        .proposal .contact-info {
            padding-left: 14px;
        }
        .proposal .contact-info .label {
            font-family: 'Work Sans', sans-serif;
            font-size: 9px;
            color: var(--text-muted);
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        .proposal .contact-info h5 {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .proposal .contact-info .company {
            font-size: 11px;
            color: var(--accent-gold);
            margin-bottom: 3px;
        }
        .proposal .contact-info .note {
            font-size: 10px;
            color: var(--text-muted);
        }
        .proposal .contact-decoration {
            width: 50px;
            height: 50px;
            border: 2px solid var(--accent-amber);
            border-radius: 4px;
            position: relative;
        }
        .proposal .contact-decoration::after {
            content: '';
            position: absolute;
            top: 6px;
            left: 6px;
            right: 6px;
            bottom: 6px;
            border: 1px solid var(--accent-gold);
            border-radius: 2px;
        }

        .proposal .footer {
            border-top: 2px solid var(--accent-amber);
            padding-top: 12px;
            text-align: center;
        }
        .proposal .footer p {
            font-family: 'Work Sans', sans-serif;
            font-size: 9px;
            color: var(--text-muted);
            letter-spacing: 1px;
        }

        /* Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÎØ∏Îãà ÏÑπÏÖò */
        .proposal .portfolio-mini {
            margin-bottom: 12px;
        }
        .proposal .portfolio-mini .cases {
            display: flex;
            gap: 8px;
        }
        .proposal .portfolio-mini .case-item {
            flex: 1;
            background: var(--card-bg);
            border-radius: 6px;
            padding: 8px 10px;
            text-align: center;
        }
        .proposal .portfolio-mini .case-metric {
            font-family: 'Work Sans', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: var(--accent-amber);
            margin-bottom: 2px;
        }
        .proposal .portfolio-mini .case-label {
            font-size: 8px;
            color: var(--text-muted);
            line-height: 1.3;
        }

        /* Î¶¨Î∑∞ Ïù∏Ïö© */
        .proposal .review-quote {
            margin-bottom: 12px;
            padding: 8px 14px;
            background: var(--card-bg);
            border-radius: 6px;
            border-left: 2px solid var(--accent-amber);
        }
        .proposal .review-quote .quote-text {
            font-size: 9px;
            color: var(--text-white);
            font-style: italic;
            margin-bottom: 3px;
        }
        .proposal .review-quote .quote-meta {
            font-size: 8px;
            color: var(--accent-gold);
        }

        /* Ïù¥Î©îÏùº Î™®Îã¨ */
        .email-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            padding: 40px;
            overflow-y: auto;
        }

        .email-modal.show {
            display: block;
        }

        .email-modal-content {
            max-width: 800px;
            margin: 0 auto;
            background: #1a1a2e;
            border-radius: 12px;
            overflow: hidden;
        }

        .email-modal-header {
            padding: 20px 25px;
            background: #26262f;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .email-modal-header h3 {
            color: #ffaf5f;
            font-size: 16px;
        }

        .email-modal-close {
            background: none;
            border: none;
            color: #8c91a0;
            font-size: 24px;
            cursor: pointer;
        }

        .email-modal-body {
            padding: 25px;
        }

        .email-field {
            margin-bottom: 20px;
        }

        .email-field label {
            display: block;
            font-size: 11px;
            color: #8c91a0;
            margin-bottom: 8px;
        }

        .email-field input,
        .email-field textarea {
            width: 100%;
            padding: 12px;
            background: #26262f;
            border: 1px solid #32323c;
            border-radius: 6px;
            color: #fff;
            font-size: 13px;
            font-family: inherit;
            line-height: 1.6;
        }

        .email-field textarea {
            min-height: 400px;
            resize: vertical;
        }

        .email-actions {
            display: flex;
            gap: 10px;
            padding: 20px 25px;
            background: #26262f;
        }

        .email-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
        }

        .email-actions .copy-btn {
            background: #ffaf5f;
            color: #1a1a2e;
        }

        .email-actions .close-btn {
            background: #32323c;
            color: #fff;
        }

        /* Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Î∏åÎùºÏö∞Ï†Ä Î™®Îã¨ */
        .influencer-browser-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            z-index: 2000;
            overflow: hidden;
        }

        .influencer-browser-modal.show {
            display: flex;
        }

        .browser-container {
            width: 100%;
            height: 100%;
            display: flex;
            background: #1a1a2e;
        }

        /* Ï¢åÏ∏°: Í≤ÄÏÉâ/Í≤∞Í≥º ÏòÅÏó≠ */
        .browser-left {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #32323c;
            min-width: 0;
            min-height: 0;
            overflow: hidden;
        }

        .browser-header {
            padding: 20px 25px;
            background: #26262f;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .browser-header h3 {
            color: #ffaf5f;
            font-size: 18px;
            font-weight: 700;
        }

        .browser-close {
            background: none;
            border: none;
            color: #8c91a0;
            font-size: 28px;
            cursor: pointer;
            line-height: 1;
        }

        .browser-close:hover {
            color: #fff;
        }

        /* Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞ */
        .browser-search {
            padding: 20px 25px;
            background: #20202a;
            flex-shrink: 0;
        }

        .search-input-wrapper {
            position: relative;
            margin-bottom: 15px;
        }

        .search-input-wrapper input {
            width: 100%;
            padding: 12px 16px 12px 44px;
            background: #26262f;
            border: 1px solid #32323c;
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
        }

        .search-input-wrapper input:focus {
            outline: none;
            border-color: #ffaf5f;
        }

        .search-input-wrapper::before {
            content: 'üîç';
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
        }

        .filter-row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-dropdown {
            position: relative;
        }

        .filter-btn {
            padding: 8px 14px;
            background: #26262f;
            border: 1px solid #32323c;
            border-radius: 6px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-btn:hover {
            border-color: #ffaf5f;
        }

        .filter-btn.active {
            border-color: #ffaf5f;
            background: #ffaf5f20;
        }

        .filter-btn::after {
            content: '‚ñº';
            font-size: 8px;
            color: #8c91a0;
        }

        .filter-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            background: #26262f;
            border: 1px solid #32323c;
            border-radius: 8px;
            padding: 8px 0;
            min-width: 160px;
            z-index: 100;
            max-height: 250px;
            overflow-y: auto;
        }

        .filter-menu.show {
            display: block;
        }

        .filter-menu label {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            cursor: pointer;
            font-size: 12px;
            color: #fff;
        }

        .filter-menu label:hover {
            background: #32323c;
        }

        .filter-menu input[type="checkbox"],
        .filter-menu input[type="radio"] {
            accent-color: #ffaf5f;
        }

        .sort-select {
            padding: 8px 14px;
            background: #26262f;
            border: 1px solid #32323c;
            border-radius: 6px;
            color: #fff;
            font-size: 12px;
            cursor: pointer;
            margin-left: auto;
        }

        /* Í≤ÄÏÉâ Í≤∞Í≥º Í∑∏Î¶¨Îìú */
        .browser-results {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px 25px;
            min-height: 0;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-card {
            background: #26262f;
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .result-card:hover {
            border-color: #32323c;
            transform: translateY(-2px);
        }

        .result-card.selected {
            border-color: #ffaf5f;
            background: #ffaf5f10;
        }

        .result-card .card-name {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 4px;
            color: #fff;
        }

        .result-card .card-handle {
            font-size: 12px;
            color: #ffaf5f;
            margin-bottom: 12px;
        }

        .result-card .card-stats {
            display: flex;
            gap: 16px;
            margin-bottom: 10px;
        }

        .result-card .stat-item {
            display: flex;
            flex-direction: column;
        }

        .result-card .stat-value {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
        }

        .result-card .stat-label {
            font-size: 10px;
            color: #8c91a0;
        }

        .result-card .card-category {
            font-size: 11px;
            color: #82b4af;
            margin-bottom: 12px;
        }

        .result-card .card-actions {
            display: flex;
            gap: 8px;
        }

        .result-card .card-actions button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }

        .result-card .btn-instagram {
            background: #32323c;
            color: #fff;
        }

        .result-card .btn-instagram:hover {
            background: #3d3d4a;
        }

        .result-card .btn-select {
            background: #ffaf5f;
            color: #1a1a2e;
        }

        .result-card .btn-select:hover {
            background: #ffd28c;
        }

        .result-card.selected .btn-select {
            background: #82b4af;
        }

        .results-loading,
        .results-empty {
            text-align: center;
            padding: 60px 20px;
            color: #8c91a0;
        }

        .results-loading::before {
            content: '‚è≥';
            display: block;
            font-size: 32px;
            margin-bottom: 12px;
        }

        .results-empty::before {
            content: 'üîç';
            display: block;
            font-size: 32px;
            margin-bottom: 12px;
        }

        /* Ïö∞Ï∏°: ÏÑ†ÌÉùÎêú Ïù∏ÌîåÎ£®Ïñ∏ÏÑú + Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ */
        .browser-right {
            width: 380px;
            display: flex;
            flex-direction: column;
            background: #20202a;
            flex-shrink: 0;
            min-height: 0;
        }

        .selected-header {
            padding: 20px 25px;
            background: #26262f;
            border-bottom: 1px solid #32323c;
        }

        .selected-header h4 {
            font-size: 14px;
            font-weight: 700;
            color: #fff;
        }

        .selected-header span {
            font-size: 12px;
            color: #8c91a0;
        }

        .selected-list {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 15px;
            min-height: 0;
        }

        .selected-item {
            background: #26262f;
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 12px;
        }

        .selected-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .selected-item-info h5 {
            font-size: 13px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 2px;
        }

        .selected-item-info span {
            font-size: 11px;
            color: #ffaf5f;
        }

        .selected-item-remove {
            background: none;
            border: none;
            color: #f09b82;
            font-size: 18px;
            cursor: pointer;
            line-height: 1;
        }

        /* Î©îÎ™® ÏûÖÎ†• */
        .memo-input {
            width: 100%;
            padding: 10px;
            background: #1a1a2e;
            border: 1px solid #32323c;
            border-radius: 6px;
            color: #fff;
            font-size: 11px;
            font-family: inherit;
            resize: none;
            min-height: 60px;
            margin-bottom: 8px;
        }

        .memo-input:focus {
            outline: none;
            border-color: #ffaf5f;
        }

        .memo-save-btn {
            width: 100%;
            padding: 8px;
            background: #82b4af;
            border: none;
            border-radius: 6px;
            color: #1a1a2e;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
        }

        .memo-save-btn:hover {
            background: #9fc9c4;
        }

        .memo-save-btn:disabled {
            background: #32323c;
            color: #8c91a0;
            cursor: not-allowed;
        }

        .memo-save-btn.saved {
            background: #82b4af;
        }

        /* ÌïòÎã® Î≤ÑÌäº */
        .browser-footer {
            padding: 20px 25px;
            background: #26262f;
            border-top: 1px solid #32323c;
        }

        .browser-footer button {
            width: 100%;
            padding: 14px;
            background: #ffaf5f;
            border: none;
            border-radius: 8px;
            color: #1a1a2e;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
        }

        .browser-footer button:hover {
            background: #ffd28c;
        }

        .browser-footer button:disabled {
            background: #32323c;
            color: #8c91a0;
            cursor: not-allowed;
        }

        /* Î™®Î∞îÏùº Î∞òÏùëÌòï */
        @media (max-width: 900px) {
            .influencer-browser-modal {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }

            .browser-container {
                flex-direction: column;
                min-height: 100%;
                height: auto;
            }

            .browser-left {
                border-right: none;
                border-bottom: 1px solid #32323c;
                flex: none;
                height: 60vh;
                min-height: 300px;
                overflow: hidden;
            }

            .browser-right {
                width: 100%;
                flex: none;
                min-height: 200px;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .filter-row {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                flex-wrap: nowrap;
                padding-bottom: 5px;
            }

            .filter-btn {
                white-space: nowrap;
            }
        }

        @media (max-width: 480px) {
            .browser-header {
                padding: 12px 16px;
            }

            .browser-header h3 {
                font-size: 16px;
            }

            .browser-search {
                padding: 12px 16px;
            }

            .browser-results {
                padding: 12px 16px;
            }

            .browser-left {
                height: 55vh;
                min-height: 260px;
            }

            .browser-right {
                min-height: 180px;
            }

            .search-input-wrapper input {
                font-size: 16px;
            }
        }

        /* Ïù∏ÏáÑÏö© */
        @media print {
            body * {
                visibility: hidden;
            }
            .proposal, .proposal * {
                visibility: visible;
            }
            .proposal {
                position: absolute;
                left: 0;
                top: 0;
                margin: 0;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            .form-panel, .preview-header {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ÏûÖÎ†• Ìèº -->
        <div class="form-panel">
            <h1>Ï†úÏïàÏÑú ÏÉùÏÑ±Í∏∞</h1>
            <p class="subtitle">Ï†ïÎ≥¥Î•º ÏûÖÎ†•ÌïòÎ©¥ Ï†úÏïàÏÑúÍ∞Ä ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§</p>

            <!-- Ï†úÌíà Ï†ïÎ≥¥ -->
            <div class="form-section">
                <h3>Ï†úÌíà Ï†ïÎ≥¥</h3>
                <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <button class="add-influencer-btn" onclick="openProductBrowser()" style="flex:1; background: #ffaf5f; color: #1a1a2e; border: none; font-weight: 600; padding: 10px;">üì¶ Ï†úÌíà Î∂àÎü¨Ïò§Í∏∞</button>
                    <button class="add-influencer-btn" onclick="openProposalBrowser()" style="flex:1; background: #a89bc9; color: #1a1a2e; border: none; font-weight: 600; padding: 10px;">üìÑ Ï†úÏïàÏÑú Î∂àÎü¨Ïò§Í∏∞</button>
                </div>
                <div class="form-group">
                    <label>Ï†úÌíàÎ™Ö *</label>
                    <input type="text" id="productName" placeholder="Ïòà: ÌååÏä§Ìá¥Î•¥ Ïö∞Ïú†" oninput="updatePreview()">
                </div>
                <div class="form-group">
                    <label>Ï†úÌíà ÏÉÅÏÑ∏</label>
                    <input type="text" id="productDetail" placeholder="Ïòà: Íº¨ÎØ∏Î£®ÎØ∏ Í≥ºÏùºÏö∞Ïú† ¬∑ ÏÜåÌôîÍ∞Ä ÏûòÎêòÎäî Ïö∞Ïú†" oninput="updatePreview()">
                </div>
                <div class="form-group">
                    <label>ÌöåÏÇ¨Î™Ö</label>
                    <input type="text" id="companyName" placeholder="Ïòà: Î°ØÎç∞Ïõ∞Ìë∏Îìú" oninput="updatePreview()">
                </div>
            </div>

            <!-- Ïù∏ÌîåÎ£®Ïñ∏ÏÑú -->
            <div class="form-section">
                <h3>Ï∂îÏ≤ú Ïù∏ÌîåÎ£®Ïñ∏ÏÑú</h3>
                <button class="add-influencer-btn" onclick="openInfluencerBrowser()" style="margin-bottom: 15px; background: #ffaf5f; color: #1a1a2e; border: none; font-weight: 600;">üîç Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ï∞æÍ∏∞</button>
                <div class="notion-search">
                    <input type="text" id="notionSearchInput" placeholder="Ïù∏ÌîåÎ£®Ïñ∏ÏÑú ID (Ïòà: unidongdong)" onkeypress="if(event.key==='Enter') fetchFromNotion()">
                    <button onclick="fetchFromNotion()" id="notionFetchBtn">Notion Î∂àÎü¨Ïò§Í∏∞</button>
                </div>
                <div class="notion-status" id="notionStatus"></div>
                <div class="influencer-list" id="influencerList">
                    <!-- Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ìï≠Î™©Îì§Ïù¥ Ïó¨Í∏∞Ïóê Ï∂îÍ∞ÄÎê® -->
                </div>
                <button class="add-influencer-btn" onclick="addInfluencer()">+ Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ï∂îÍ∞Ä</button>
            </div>

            <!-- ÎÇ†Ïßú -->
            <div class="form-section">
                <h3>Í∏∞ÌÉÄ Ï†ïÎ≥¥</h3>
                <div class="form-group">
                    <label>Ï†úÏïà ÎÇ†Ïßú</label>
                    <input type="text" id="proposalDate" placeholder="Ïòà: 2025.02" oninput="updatePreview()">
                </div>
            </div>

            <!-- Î≤ÑÌäº -->
            <div class="btn-group">
                <button class="btn btn-primary" onclick="printProposal()">PDF Ï†ÄÏû•</button>
                <button class="btn btn-secondary" onclick="downloadHTML()">HTML Îã§Ïö¥Î°úÎìú</button>
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" onclick="generateEmail()" style="flex:1; background:#82b4af; color:#1a1a2e;">Ïù¥Î©îÏùº ÏÉùÏÑ±</button>
            </div>
            <div class="btn-group" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #32323c;">
                <button class="btn btn-secondary" onclick="saveProposal('Ï¥àÏïà')" style="flex:1; background:#a89bc9; color:#1a1a2e;">NotionÏóê Ï†ÄÏû•</button>
            </div>
            <div id="proposalLinkArea" style="display: none; margin-top: 10px; padding: 10px; background: #2a2a3a; border-radius: 8px; text-align: center;">
                <a id="proposalNotionLink" href="#" target="_blank" style="color: #a89bc9; text-decoration: none; font-weight: 600;">
                    üìÑ NotionÏóêÏÑú Î≥¥Í∏∞ ‚Üí
                </a>
            </div>
        </div>

        <!-- ÎØ∏Î¶¨Î≥¥Í∏∞ -->
        <div class="preview-panel">
            <div class="preview-header">
                <h2>ÎØ∏Î¶¨Î≥¥Í∏∞</h2>
            </div>
            <div class="preview-frame">
                <div class="proposal" id="proposalPreview">
                    <!-- Ï†úÏïàÏÑú ÎÇ¥Ïö©Ïù¥ Ïó¨Í∏∞Ïóê Î†åÎçîÎßÅÎê® -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Î∏åÎùºÏö∞Ï†Ä Î™®Îã¨ -->
    <div class="influencer-browser-modal" id="influencerBrowserModal">
        <div class="browser-container">
            <!-- Ï¢åÏ∏°: Í≤ÄÏÉâ/Í≤∞Í≥º -->
            <div class="browser-left">
                <div class="browser-header">
                    <h3>Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ï∞æÍ∏∞</h3>
                    <button class="browser-close" onclick="closeInfluencerBrowser()">&times;</button>
                </div>
                <div class="browser-search">
                    <div class="search-input-wrapper">
                        <input type="text" id="browserSearchInput" placeholder="Ïù¥Î¶Ñ, Ìï∏Îì§, Ïπ¥ÌÖåÍ≥†Î¶¨Î°ú Í≤ÄÏÉâ..." oninput="debounceSearch()">
                    </div>
                    <div class="filter-row">
                        <div class="filter-dropdown">
                            <button class="filter-btn" onclick="toggleFilterMenu('categoryFilter')" id="categoryFilterBtn">
                                Ïπ¥ÌÖåÍ≥†Î¶¨
                            </button>
                            <div class="filter-menu" id="categoryFilter">
                                <!-- Ï∫êÏãú Î°úÎìú ÌõÑ ÎèôÏ†Å ÏÉùÏÑ± -->
                                <div style="padding: 8px 14px; color: #8c91a0; font-size: 11px;">Î°úÎî© Ï§ë...</div>
                            </div>
                        </div>
                        <div class="filter-dropdown">
                            <button class="filter-btn" onclick="toggleFilterMenu('followerFilter')" id="followerFilterBtn">
                                ÌåîÎ°úÏõå
                            </button>
                            <div class="filter-menu" id="followerFilter">
                                <label><input type="radio" name="follower" value="0" checked onchange="applyFilters()"> Ï†ÑÏ≤¥</label>
                                <label><input type="radio" name="follower" value="10000" onchange="applyFilters()"> 1Îßå Ïù¥ÏÉÅ</label>
                                <label><input type="radio" name="follower" value="50000" onchange="applyFilters()"> 5Îßå Ïù¥ÏÉÅ</label>
                                <label><input type="radio" name="follower" value="100000" onchange="applyFilters()"> 10Îßå Ïù¥ÏÉÅ</label>
                                <label><input type="radio" name="follower" value="200000" onchange="applyFilters()"> 20Îßå Ïù¥ÏÉÅ</label>
                            </div>
                        </div>
                        <div class="filter-dropdown">
                            <button class="filter-btn" onclick="toggleFilterMenu('viewsFilter')" id="viewsFilterBtn">
                                Î¶¥Ïä§ Ï°∞ÌöåÏàò
                            </button>
                            <div class="filter-menu" id="viewsFilter">
                                <label><input type="radio" name="views" value="0" checked onchange="applyFilters()"> Ï†ÑÏ≤¥</label>
                                <label><input type="radio" name="views" value="10000" onchange="applyFilters()"> 1Îßå Ïù¥ÏÉÅ</label>
                                <label><input type="radio" name="views" value="50000" onchange="applyFilters()"> 5Îßå Ïù¥ÏÉÅ</label>
                                <label><input type="radio" name="views" value="100000" onchange="applyFilters()"> 10Îßå Ïù¥ÏÉÅ</label>
                                <label><input type="radio" name="views" value="200000" onchange="applyFilters()"> 20Îßå Ïù¥ÏÉÅ</label>
                            </div>
                        </div>
                        <select class="sort-select" id="sortSelect" onchange="applyFilters()">
                            <option value="avgViews">Ï°∞ÌöåÏàò ÎÜíÏùÄ Ïàú</option>
                            <option value="followers">ÌåîÎ°úÏõå ÎßéÏùÄ Ïàú</option>
                            <option value="name">Ïù¥Î¶Ñ Ïàú</option>
                        </select>
                    </div>
                </div>
                <div class="browser-results" id="browserResults">
                    <div class="results-empty">Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÍ±∞ÎÇò ÌïÑÌÑ∞Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                </div>
            </div>

            <!-- Ïö∞Ï∏°: ÏÑ†ÌÉùÎêú Ïù∏ÌîåÎ£®Ïñ∏ÏÑú + Ï≤¥ÌÅ¨Î¶¨Ïä§Ìä∏ -->
            <div class="browser-right">
                <div class="selected-header">
                    <h4>ÏÑ†ÌÉùÎêú Ïù∏ÌîåÎ£®Ïñ∏ÏÑú <span id="selectedCount">(0/5)</span></h4>
                </div>
                <div class="selected-list" id="selectedList">
                    <div class="results-empty" style="padding: 40px 20px;">Ïù∏ÌîåÎ£®Ïñ∏ÏÑúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
                </div>
                <div class="browser-footer">
                    <button onclick="addSelectedToProposal()" id="addToProposalBtn" disabled>Ï†úÏïàÏÑúÏóê Ï∂îÍ∞Ä</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ï†úÌíà Î∏åÎùºÏö∞Ï†Ä Î™®Îã¨ -->
    <div class="email-modal" id="productBrowserModal" onclick="if(event.target===this) closeProductBrowser()">
        <div class="email-modal-content" style="max-width: 600px;">
            <div class="email-modal-header">
                <h3>üì¶ Ï†úÌíà Î∂àÎü¨Ïò§Í∏∞</h3>
                <button class="email-modal-close" onclick="closeProductBrowser()">&times;</button>
            </div>
            <div class="email-modal-body" style="padding: 20px;">
                <div style="display: flex; gap: 8px; margin-bottom: 15px;">
                    <input type="text" id="productSearchInput" placeholder="Ï†úÌíàÎ™Ö Í≤ÄÏÉâ..." style="flex:1; padding: 10px; background: #26262f; border: 1px solid #32323c; border-radius: 6px; color: #fff;">
                    <button onclick="searchProducts()" style="padding: 10px 16px; background: #ffaf5f; border: none; border-radius: 6px; color: #1a1a2e; font-weight: 600; cursor: pointer;">Í≤ÄÏÉâ</button>
                </div>
                <div id="productSearchResults" style="max-height: 400px; overflow-y: auto;">
                    <p style="color: #8c91a0; text-align: center; padding: 20px;">Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÍ±∞ÎÇò Í≤ÄÏÉâ Î≤ÑÌäºÏùÑ ÎàåÎü¨ Ï†ÑÏ≤¥ Î™©Î°ùÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ï†úÏïàÏÑú Î∏åÎùºÏö∞Ï†Ä Î™®Îã¨ -->
    <div class="email-modal" id="proposalBrowserModal" onclick="if(event.target===this) closeProposalBrowser()">
        <div class="email-modal-content" style="max-width: 700px;">
            <div class="email-modal-header">
                <h3>üìÑ Ï†úÏïàÏÑú Î∂àÎü¨Ïò§Í∏∞</h3>
                <button class="email-modal-close" onclick="closeProposalBrowser()">&times;</button>
            </div>
            <div class="email-modal-body" style="padding: 20px;">
                <div id="proposalList" style="max-height: 450px; overflow-y: auto;">
                    <p style="color: #8c91a0; text-align: center; padding: 20px;">Î°úÎî© Ï§ë...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ïù¥Î©îÏùº Î™®Îã¨ -->
    <div class="email-modal" id="emailModal" onclick="if(event.target===this) closeEmailModal()">
        <div class="email-modal-content">
            <div class="email-modal-header">
                <h3>Ï†úÏïà Ïù¥Î©îÏùº ÏÉùÏÑ±</h3>
                <button class="email-modal-close" onclick="closeEmailModal()">&times;</button>
            </div>
            <div class="email-modal-body">
                <div class="email-field">
                    <label>Ï†úÎ™©</label>
                    <input type="text" id="emailSubject" readonly>
                </div>
                <div class="email-field">
                    <label>Î≥∏Î¨∏</label>
                    <textarea id="emailBody" readonly></textarea>
                </div>
            </div>
            <div class="email-actions">
                <button class="copy-btn" onclick="copyEmail()">Ï†ÑÏ≤¥ Î≥µÏÇ¨</button>
                <button class="close-btn" onclick="closeEmailModal()">Îã´Í∏∞</button>
            </div>
        </div>
    </div>

    <script>
        // ============ ÏÑ§Ï†ï ============
        // Cloudflare Worker Î∞∞Ìè¨ ÌõÑ Ïù¥ URLÏùÑ Î≥ÄÍ≤ΩÌïòÏÑ∏Ïöî
        const NOTION_PROXY_URL = 'https://notion-proxy.dev-joongi.workers.dev';
        const NOTION_DATABASE_ID = '2fb3d45b094580ac9fe0e622afc21c4a';  // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú DB
        const PROPOSAL_DATABASE_ID = '17029bd4e5ca4339a67f84e63d99b266';  // Ï†úÏïàÏÑú DB
        const PRODUCT_DATABASE_ID = '2fb3d45b094580aab89bee0cdc950b3a';  // Ï†úÌíàÏÜåÏã± DB

        // ÌòÑÏû¨ Î°úÎìúÎêú Ï†úÌíà Ï†ïÎ≥¥
        let currentProduct = null;

        // ÏïÑÎ∞îÌÉÄ ÏÉâÏÉÅ Î∞∞Ïó¥
        const avatarColors = ['coral', 'teal', 'purple', 'amber'];

        // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Îç∞Ïù¥ÌÑ∞
        let influencers = [];
        let influencerIdCounter = 0;

        // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Í∏∞Î≥∏ Íµ¨Ï°∞
        function createInfluencer() {
            return { id: influencerIdCounter++, name: '', handle: '', followers: '', avgViews: '', category: '' };
        }

        // ============ Notion Ïó∞Îèô ============
        function showNotionStatus(message, type) {
            const status = document.getElementById('notionStatus');
            status.textContent = message;
            status.className = 'notion-status show ' + type;
            if (type === 'success' || type === 'error') {
                setTimeout(() => status.classList.remove('show'), 3000);
            }
        }

        async function fetchFromNotion() {
            const input = document.getElementById('notionSearchInput');
            const btn = document.getElementById('notionFetchBtn');
            const query = input.value.trim();

            if (!query) {
                showNotionStatus('Ïù∏ÌîåÎ£®Ïñ∏ÏÑú IDÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî', 'error');
                return;
            }

            btn.disabled = true;
            btn.textContent = 'Î°úÎî©...';
            showNotionStatus('NotionÏóêÏÑú Í≤ÄÏÉâ Ï§ë...', 'loading');

            try {
                const response = await fetch(NOTION_PROXY_URL + '/query', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        influencerId: query,
                        databaseId: NOTION_DATABASE_ID
                    })
                });

                if (!response.ok) {
                    throw new Error('API ÏöîÏ≤≠ Ïã§Ìå®');
                }

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                if (!data.name) {
                    showNotionStatus(`"${query}" Ïù∏ÌîåÎ£®Ïñ∏ÏÑúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§`, 'error');
                    return;
                }

                // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ï∂îÍ∞Ä
                addInfluencerFromNotion(data);
                showNotionStatus(`${data.name} Ï∂îÍ∞ÄÎê®`, 'success');
                input.value = '';

            } catch (error) {
                console.error('Notion fetch error:', error);
                showNotionStatus('Notion Ïó∞Í≤∞ Ïã§Ìå®: ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = 'Notion Î∂àÎü¨Ïò§Í∏∞';
            }
        }

        function addInfluencerFromNotion(data) {
            const id = influencerIdCounter++;
            const followers = data.followers ? data.followers + 'Îßå' : '';
            const avgViews = data.avgViews ? data.avgViews + 'Îßå' : '';

            influencers.push({
                id,
                name: data.name.split('„Ö£')[0].trim(), // "Ïö∞ÎãàÎèôÎèô„Ö£Yunhee Choi" -> "Ïö∞ÎãàÎèôÎèô"
                handle: data.handle || '@' + data.influencerId,
                followers: followers,
                avgViews: avgViews,
                category: data.categoryMain?.join('¬∑') || '',
                notionPageId: data.id  // Notion ÌéòÏù¥ÏßÄ ID Ï†ÄÏû• (Ï†úÏïàÏÑú Ï†ÄÏû•Ïö©)
            });

            renderInfluencerList();
            updatePreview();
        }

        // Î™®Î∞îÏùº ÎØ∏Î¶¨Î≥¥Í∏∞ Ïä§ÏºÄÏùº Ï°∞Ï†ï
        function adjustPreviewScale() {
            const proposal = document.getElementById('proposalPreview');
            const previewPanel = document.querySelector('.preview-panel');
            if (!proposal || !previewPanel) return;

            if (window.innerWidth <= 900) {
                const padding = 20;
                const availableWidth = previewPanel.clientWidth - padding;
                const proposalWidth = 794; // 210mm in pixels
                const scale = availableWidth / proposalWidth;

                proposal.style.transform = `scale(${scale})`;

                // Ïª®ÌÖåÏù¥ÎÑà ÎÜíÏù¥ Ï°∞Ï†ï
                const previewFrame = document.querySelector('.preview-frame');
                if (previewFrame) {
                    previewFrame.style.height = (1123 * scale) + 'px'; // 297mm in pixels
                }
            } else {
                proposal.style.transform = '';
                const previewFrame = document.querySelector('.preview-frame');
                if (previewFrame) {
                    previewFrame.style.height = '';
                }
            }
        }

        // Ï¥àÍ∏∞Ìôî
        // ============ URL ÌååÎùºÎØ∏ÌÑ∞ & Ï†úÌíà ÏûêÎèô Î°úÎìú ============
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                productId: params.get('product'),
                proposalId: params.get('proposal')
            };
        }

        async function loadProductFromNotion(productId) {
            try {
                showNotionStatus('Ï†úÌíà Ï†ïÎ≥¥ Î°úÎî© Ï§ë...', 'loading');

                const response = await fetch(NOTION_PROXY_URL + '/product', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pageId: productId })
                });

                if (!response.ok) {
                    throw new Error('Ï†úÌíà Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§');
                }

                const product = await response.json();
                currentProduct = product;

                // ÌèºÏóê Ï†úÌíà Ï†ïÎ≥¥ Ï±ÑÏö∞Í∏∞
                const productNameEl = document.getElementById('productName');
                const companyNameEl = document.getElementById('companyName');

                if (productNameEl) productNameEl.value = product.name || '';
                if (companyNameEl) companyNameEl.value = product.companyName || '';

                // ÌïèÌïú Ïù∏ÌîåÎ£®Ïñ∏ÏÑúÍ∞Ä ÏûàÏúºÎ©¥ ÏûêÎèô Ï∂îÍ∞Ä
                if (product.fitInfluencers && product.fitInfluencers.length > 0) {
                    // Í∏∞Ï°¥ Îπà Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ï†úÍ±∞
                    influencers = [];

                    product.fitInfluencers.forEach(inf => {
                        const displayName = inf.name ? inf.name.split('„Ö£')[0].trim() : '';
                        influencers.push({
                            id: influencerIdCounter++,
                            name: displayName,
                            handle: inf.handle || '@' + inf.influencerId,
                            followers: inf.followers ? inf.followers + 'Îßå' : '',
                            avgViews: inf.avgViews ? inf.avgViews + 'Îßå' : '',
                            category: inf.categoryMain?.join('¬∑') || '',
                            notionPageId: inf.id  // Notion ÌéòÏù¥ÏßÄ ID Ï†ÄÏû•
                        });
                    });

                    renderInfluencerList();
                    showNotionStatus(`Ï†úÌíà "${product.name}" Î∞è ÌïèÌïú Ïù∏ÌîåÎ£®Ïñ∏ÏÑú ${product.fitInfluencers.length}Î™Ö Î°úÎìúÎê®`, 'success');
                } else {
                    showNotionStatus(`Ï†úÌíà "${product.name}" Î°úÎìúÎê®`, 'success');
                }

                updatePreview();
                return product;

            } catch (error) {
                console.error('Load product error:', error);
                showNotionStatus('Ï†úÌíà Ï†ïÎ≥¥ Î°úÎìú Ïã§Ìå®: ' + error.message, 'error');
                return null;
            }
        }

        // ============ Ï†úÏïàÏÑú Ï†ÄÏû• ============
        async function saveProposal(status = 'Ï¥àÏïà') {
            const productName = document.getElementById('productName').value || '';
            const today = new Date().toISOString().split('T')[0];
            const title = `${productName} - ${today}`;

            // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Notion ÌéòÏù¥ÏßÄ ID ÏàòÏßë
            const influencerPageIds = influencers
                .filter(inf => inf.notionPageId)
                .map(inf => inf.notionPageId);

            // Ïù¥Î©îÏùº/Ïπ¥Ïπ¥Ïò§ÌÜ° ÎÇ¥Ïö©
            const emailContent = document.getElementById('emailBody')?.value || '';
            const kakaoContent = ''; // Ïπ¥Ïπ¥Ïò§ÌÜ° ÏÉùÏÑ±Í∏∞ÏóêÏÑú Í∞ÄÏ†∏Ïò§ÎèÑÎ°ù ÌôïÏû• Í∞ÄÎä•

            try {
                const response = await fetch(NOTION_PROXY_URL + '/save-proposal', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        proposalDatabaseId: PROPOSAL_DATABASE_ID,
                        title,
                        productPageId: currentProduct?.id || null,
                        influencerPageIds,
                        emailContent,
                        kakaoContent,
                        status
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showNotionStatus(`Ï†úÏïàÏÑú Ï†ÄÏû•Îê®: ${title}`, 'success');
                    // Î∞îÎ°úÍ∞ÄÍ∏∞ ÎßÅÌÅ¨ ÌëúÏãú
                    if (data.url) {
                        showProposalLink(data.url);
                    }
                    return data;
                } else {
                    throw new Error(data.error || 'Ï†ÄÏû• Ïã§Ìå®');
                }
            } catch (error) {
                console.error('Save proposal error:', error);
                showNotionStatus('Ï†úÏïàÏÑú Ï†ÄÏû• Ïã§Ìå®: ' + error.message, 'error');
                return null;
            }
        }

        // Ï†úÏïàÏÑú Notion ÎßÅÌÅ¨ ÌëúÏãú
        function showProposalLink(url) {
            const linkArea = document.getElementById('proposalLinkArea');
            const link = document.getElementById('proposalNotionLink');
            if (linkArea && link) {
                link.href = url;
                linkArea.style.display = 'block';
            }
        }

        // ============ Ï†úÌíà Î∏åÎùºÏö∞Ï†Ä ============
        function openProductBrowser() {
            document.getElementById('productBrowserModal').classList.add('show');
            document.getElementById('productSearchInput').value = '';
            document.getElementById('productSearchResults').innerHTML = '<p style="color: #8c91a0; text-align: center; padding: 20px;">Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÍ±∞ÎÇò Í≤ÄÏÉâ Î≤ÑÌäºÏùÑ ÎàåÎü¨ Ï†ÑÏ≤¥ Î™©Î°ùÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî</p>';
        }

        function closeProductBrowser() {
            document.getElementById('productBrowserModal').classList.remove('show');
        }

        async function searchProducts() {
            const query = document.getElementById('productSearchInput').value.trim();
            const resultsContainer = document.getElementById('productSearchResults');

            resultsContainer.innerHTML = '<p style="color: #8c91a0; text-align: center; padding: 20px;">Í≤ÄÏÉâ Ï§ë...</p>';

            try {
                const response = await fetch(NOTION_PROXY_URL + '/search-products', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        databaseId: PRODUCT_DATABASE_ID,
                        query: query,
                        limit: 30
                    })
                });

                const data = await response.json();

                if (!data.results || data.results.length === 0) {
                    resultsContainer.innerHTML = '<p style="color: #8c91a0; text-align: center; padding: 20px;">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</p>';
                    return;
                }

                resultsContainer.innerHTML = data.results.map(product => `
                    <div style="padding: 12px; background: #26262f; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: background 0.2s;"
                         onclick="selectProduct('${product.id}')"
                         onmouseover="this.style.background='#32323c'"
                         onmouseout="this.style.background='#26262f'">
                        <div style="font-weight: 600; color: #fff; margin-bottom: 4px;">${product.name || '(Ï†úÌíàÎ™Ö ÏóÜÏùå)'}</div>
                        <div style="font-size: 12px; color: #8c91a0;">
                            ${product.companyName || ''} ${product.category?.length ? '¬∑ ' + product.category.join(', ') : ''}
                        </div>
                        <div style="font-size: 11px; color: #ffaf5f; margin-top: 4px;">
                            ÌïèÌïú Ïù∏ÌîåÎ£®Ïñ∏ÏÑú: ${product.fitInfluencerIds?.length || 0}Î™Ö
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Search products error:', error);
                resultsContainer.innerHTML = '<p style="color: #f09b82; text-align: center; padding: 20px;">Í≤ÄÏÉâ Ïã§Ìå®: ' + error.message + '</p>';
            }
        }

        async function selectProduct(productId) {
            closeProductBrowser();
            await loadProductFromNotion(productId);
        }

        // ============ Ï†úÏïàÏÑú Î∏åÎùºÏö∞Ï†Ä ============
        function openProposalBrowser() {
            document.getElementById('proposalBrowserModal').classList.add('show');
            loadProposalList();
        }

        function closeProposalBrowser() {
            document.getElementById('proposalBrowserModal').classList.remove('show');
        }

        async function loadProposalList() {
            const listContainer = document.getElementById('proposalList');
            listContainer.innerHTML = '<p style="color: #8c91a0; text-align: center; padding: 20px;">Î°úÎî© Ï§ë...</p>';

            try {
                const response = await fetch(NOTION_PROXY_URL + '/load-proposals', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        proposalDatabaseId: PROPOSAL_DATABASE_ID,
                        limit: 30
                    })
                });

                const data = await response.json();

                if (!data.results || data.results.length === 0) {
                    listContainer.innerHTML = '<p style="color: #8c91a0; text-align: center; padding: 20px;">Ï†ÄÏû•Îêú Ï†úÏïàÏÑúÍ∞Ä ÏóÜÏäµÎãàÎã§</p>';
                    return;
                }

                listContainer.innerHTML = data.results.map(proposal => `
                    <div style="padding: 15px; background: #26262f; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: background 0.2s;"
                         onclick="selectProposal('${proposal.id}')"
                         onmouseover="this.style.background='#32323c'"
                         onmouseout="this.style.background='#26262f'">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;">
                            <span style="font-weight: 600; color: #fff;">${proposal.title || '(Ï†úÎ™© ÏóÜÏùå)'}</span>
                            <span style="font-size: 11px; padding: 3px 8px; background: ${proposal.status === 'Î∞úÏÜ°ÏôÑÎ£å' ? '#82b4af' : '#a89bc9'}; color: #1a1a2e; border-radius: 4px;">${proposal.status || 'Ï¥àÏïà'}</span>
                        </div>
                        <div style="font-size: 12px; color: #8c91a0;">
                            ÏÉùÏÑ±Ïùº: ${proposal.createdDate || '-'} ¬∑ Ïù∏ÌîåÎ£®Ïñ∏ÏÑú: ${proposal.influencerIds?.length || 0}Î™Ö
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Load proposals error:', error);
                listContainer.innerHTML = '<p style="color: #f09b82; text-align: center; padding: 20px;">Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®: ' + error.message + '</p>';
            }
        }

        async function selectProposal(proposalId) {
            closeProposalBrowser();
            showNotionStatus('Ï†úÏïàÏÑú Î°úÎî© Ï§ë...', 'loading');

            try {
                // Ï†úÏïàÏÑú ÏÉÅÏÑ∏ Ï†ïÎ≥¥ Ï°∞Ìöå
                const response = await fetch(NOTION_PROXY_URL + '/fetch', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ pageId: proposalId })
                });

                const data = await response.json();

                // Ï†úÏïàÏÑú Îç∞Ïù¥ÌÑ∞ ÌååÏã±
                const props = data.properties;
                const title = props['Ï†úÏïàÏÑúÎ™Ö']?.title?.[0]?.plain_text || '';
                const emailContent = props['Ïù¥Î©îÏùº Î≥∏Î¨∏']?.rich_text?.[0]?.plain_text || '';
                const productIds = props['Ï†úÌíà']?.relation?.map(r => r.id) || [];

                // Ï†úÌíàÎ™Ö Ï∂îÏ∂ú (Ï†úÏïàÏÑúÎ™ÖÏóêÏÑú)
                const productName = title.split(' - ')[0] || '';
                document.getElementById('productName').value = productName;

                // Ïù¥Î©îÏùº Î≥∏Î¨∏Ïù¥ ÏûàÏúºÎ©¥ Ïù¥Î©îÏùº Î™®Îã¨Ïóê ÏÑ§Ï†ï
                if (emailContent) {
                    document.getElementById('emailBody').value = emailContent;
                }

                // Ï†úÌíàÏù¥ Ïó∞Í≤∞ÎêòÏñ¥ ÏûàÏúºÎ©¥ Î°úÎìú
                if (productIds.length > 0) {
                    await loadProductFromNotion(productIds[0]);
                } else {
                    updatePreview();
                }

                // Î∞îÎ°úÍ∞ÄÍ∏∞ ÎßÅÌÅ¨ ÌëúÏãú
                if (data.url) {
                    showProposalLink(data.url);
                }

                showNotionStatus(`Ï†úÏïàÏÑú "${title}" Î∂àÎü¨Ïò¥`, 'success');

            } catch (error) {
                console.error('Select proposal error:', error);
                showNotionStatus('Ï†úÏïàÏÑú Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®: ' + error.message, 'error');
            }
        }

        // Enter ÌÇ§Î°ú Ï†úÌíà Í≤ÄÏÉâ
        document.addEventListener('DOMContentLoaded', function() {
            const productSearchInput = document.getElementById('productSearchInput');
            if (productSearchInput) {
                productSearchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') searchProducts();
                });
            }
        });

        function init() {
            // Í∏∞Î≥∏Í∞í ÏÑ§Ï†ï
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            document.getElementById('proposalDate').value = `${year}.${month}`;

            // Îπà Ïù∏ÌîåÎ£®Ïñ∏ÏÑú 1Í∞úÎ°ú ÏãúÏûë (NotionÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞ ÏÇ¨Ïö© Í∂åÏû•)
            addInfluencer();

            // ÎØ∏Î¶¨Î≥¥Í∏∞ Ïä§ÏºÄÏùº Ï°∞Ï†ï
            adjustPreviewScale();
            window.addEventListener('resize', adjustPreviewScale);

            updatePreview();
        }

        // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ï∂îÍ∞Ä
        function addInfluencer() {
            influencers.push(createInfluencer());
            renderInfluencerList();
            updatePreview();
        }

        // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú ÏÇ≠Ï†ú
        function removeInfluencer(id) {
            influencers = influencers.filter(inf => inf.id !== id);
            renderInfluencerList();
            updatePreview();
        }

        // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú ÏóÖÎç∞Ïù¥Ìä∏
        function updateInfluencer(id, field, value) {
            const inf = influencers.find(i => i.id === id);
            if (inf) {
                inf[field] = value;
                updatePreview();
            }
        }

        // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Î¶¨Ïä§Ìä∏ Î†åÎçîÎßÅ
        function renderInfluencerList() {
            const list = document.getElementById('influencerList');
            list.innerHTML = influencers.map((inf, index) => `
                <div class="influencer-item">
                    ${influencers.length > 1 ? `<button class="remove-btn" onclick="removeInfluencer(${inf.id})">√ó</button>` : ''}
                    <div class="form-group">
                        <label>Ïù¥Î¶Ñ</label>
                        <input type="text" value="${inf.name}" placeholder="Ïòà: Ïö∞ÎãàÎèôÎèô"
                            oninput="updateInfluencer(${inf.id}, 'name', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Ïù∏Ïä§ÌÉÄÍ∑∏Îû® Ìï∏Îì§</label>
                        <input type="text" value="${inf.handle}" placeholder="Ïòà: @unidongdong"
                            oninput="updateInfluencer(${inf.id}, 'handle', this.value)">
                    </div>
                    <div class="influencer-row">
                        <div class="form-group">
                            <label>ÌåîÎ°úÏõå</label>
                            <input type="text" value="${inf.followers}" placeholder="Ïòà: 23.1Îßå"
                                oninput="updateInfluencer(${inf.id}, 'followers', this.value)">
                        </div>
                        <div class="form-group">
                            <label>ÌèâÍ∑† Î¶¥Ïä§ Ï°∞ÌöåÏàò</label>
                            <input type="text" value="${inf.avgViews}" placeholder="Ïòà: 10Îßå"
                                oninput="updateInfluencer(${inf.id}, 'avgViews', this.value)">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Ïπ¥ÌÖåÍ≥†Î¶¨</label>
                        <input type="text" value="${inf.category || ''}" placeholder="Ïòà: ÏÇ¥Î¶º¬∑Î¶¨Îπô"
                            oninput="updateInfluencer(${inf.id}, 'category', this.value)">
                    </div>
                </div>
            `).join('');
        }

        // ÎØ∏Î¶¨Î≥¥Í∏∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updatePreview() {
            const productName = document.getElementById('productName').value || '[Ï†úÌíàÎ™Ö]';
            const productDetail = document.getElementById('productDetail').value || '[Ï†úÌíà ÏÉÅÏÑ∏]';
            const companyName = document.getElementById('companyName').value || '[ÌöåÏÇ¨Î™Ö]';
            const proposalDate = document.getElementById('proposalDate').value || '2025.02';

            // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ïπ¥Îìú ÏÉùÏÑ±
            const influencerCards = influencers.map((inf, index) => `
                <div class="influencer-card">
                    <div class="avatar ${avatarColors[index % avatarColors.length]}"></div>
                    <div class="info">
                        <h5>${inf.name || '[Ïù¥Î¶Ñ]'}</h5>
                        <p class="handle">${inf.handle || '@handle'}</p>
                        <p class="stats">ÌåîÎ°úÏõå ${inf.followers || '-'} ¬∑ ÌèâÍ∑† Î¶¥Ïä§ Ï°∞ÌöåÏàò ${inf.avgViews || '-'}</p>
                    </div>
                </div>
            `).join('');

            document.getElementById('proposalPreview').innerHTML = `
                <div class="top-bar"></div>
                <div class="corner-bracket top-left"></div>
                <div class="corner-bracket top-right"></div>
                <div class="corner-bracket bottom-right"></div>

                <div class="header">
                    <span>DEARDAYS AGENCY</span>
                    <span>${proposalDate}</span>
                </div>

                <div class="title-section">
                    <div class="accent-line"></div>
                    <h1>Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Í≥µÎèôÍµ¨Îß§</h1>
                    <h2>ÌòëÏóÖ Ï†úÏïàÏÑú</h2>
                    <p class="subtitle">INFLUENCER COLLABORATION PROPOSAL</p>
                    <div class="divider"></div>
                </div>

                <div class="product-card">
                    <div class="product-info">
                        <p class="label">PRODUCT</p>
                        <h3>${productName}</h3>
                        <p class="detail">${productDetail}</p>
                        <p class="company">${companyName}</p>
                    </div>
                </div>

                <div class="influencer-section">
                    <div class="section-header">
                        <div class="line"></div>
                        <p class="eng">RECOMMENDED INFLUENCERS</p>
                        <h4>Ï∂îÏ≤ú Ïù∏ÌîåÎ£®Ïñ∏ÏÑú</h4>
                    </div>
                    <div class="influencer-cards">
                        ${influencerCards}
                    </div>
                    <p class="influencer-note">* ÎπÑÏä∑Ìïú Í∑úÎ™®Ïùò Îã§Î•∏ Ïù∏ÌîåÎ£®Ïñ∏ÏÑúÏôÄÏùò ÌòëÏóÖÎèÑ Í∞ÄÎä•Ìï©ÎãàÎã§</p>
                </div>

                <div class="promise-section">
                    <div class="section-header">
                        <div class="line"></div>
                        <p class="eng">OUR PROMISE</p>
                        <h4>ÌòëÏóÖ ÏïΩÏÜç</h4>
                    </div>
                    <div class="promise-list">
                        <div class="promise-item">
                            <span class="number">1</span>
                            <span class="text">Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò Î∂ÑÏÑùÏúºÎ°ú Ï†úÌíàÏùò ÏãúÏû• Ïû†Ïû¨Î†•ÏùÑ Î∞úÍµ¥Ìï©ÎãàÎã§</span>
                        </div>
                        <div class="promise-item">
                            <span class="number">2</span>
                            <span class="text">Î∏åÎûúÎìú Ïù∏ÏßÄÎèÑ ÏÉÅÏäπÍ≥º Îß§Ï∂ú Î™©ÌëúÎ•º ÎèôÏãúÏóê Îã¨ÏÑ±Ìï©ÎãàÎã§</span>
                        </div>
                        <div class="promise-item">
                            <span class="number">3</span>
                            <span class="text">ÌèâÍ∑† 10Î∂Ñ ÎÇ¥ ÎãµÎ≥Ä, Ìà¨Î™ÖÌïú Ïª§ÎÆ§ÎãàÏºÄÏù¥ÏÖòÏùÑ ÏïΩÏÜçÌï©ÎãàÎã§</span>
                        </div>
                    </div>
                </div>

                <div class="portfolio-mini">
                    <div class="section-header">
                        <div class="line"></div>
                        <p class="eng">PORTFOLIO</p>
                        <h4>ÏÑ±Í≥µ ÏÇ¨Î°Ä</h4>
                    </div>
                    <div class="cases">
                        <div class="case-item">
                            <p class="case-metric">5Ï∞® ÏôÑÌåê</p>
                            <p class="case-label">Î∑∞Ìã∞ Î∏åÎûúÎìú<br>Ïù∏ÏßÄÎèÑ Ï†úÎ°úÏóêÏÑú Îã¨ÏÑ±</p>
                        </div>
                        <div class="case-item">
                            <p class="case-metric">6ÏãúÍ∞Ñ</p>
                            <p class="case-label">ÏãùÌíà Î∏åÎûúÎìú<br>Î°†Ïπ≠ ÎãπÏùº Ï†ÑÎüâ ÏÜåÏßÑ</p>
                        </div>
                        <div class="case-item">
                            <p class="case-metric">+300%</p>
                            <p class="case-label">ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº<br>Ïã†Í∑ú Í≥†Í∞ù Ïú†ÏûÖ Ï¶ùÍ∞Ä</p>
                        </div>
                    </div>
                </div>

                <div class="agency-section">
                    <div class="agency-header">
                        <h4>DEARDAYS</h4>
                        <span>Í≥µÎèôÍµ¨Îß§ Ï†ÑÎ¨∏ ÏóêÏù¥Ï†ÑÏãú</span>
                    </div>
                    <div class="stats">
                        <div class="stat">
                            <p class="value">98%</p>
                            <p class="label">Í≥†Í∞ù ÎßåÏ°±ÎèÑ</p>
                        </div>
                        <div class="stat">
                            <p class="value">400+</p>
                            <p class="label">ÎàÑÏ†Å ÌîÑÎ°úÏ†ùÌä∏</p>
                        </div>
                        <div class="stat">
                            <p class="value">50+</p>
                            <p class="label">ÌòëÏóÖ Î∏åÎûúÎìú</p>
                        </div>
                        <div class="stat">
                            <p class="value">10Î∂Ñ</p>
                            <p class="label">ÌèâÍ∑† ÏùëÎãµÏãúÍ∞Ñ</p>
                        </div>
                    </div>
                </div>

                <div class="review-quote">
                    <p class="quote-text">"Í≥µÍµ¨Î°ú Î∞îÏù¥Îü¥Ïù¥ Ïûò ÎêòÏñ¥ÏÑú Ï†ÄÌù¨Ï™Ω Î∏åÎûúÎìú Ïù∏ÏßÄÎèÑÍ∞Ä ÎßéÏù¥ Ïò¨ÎùºÍ∞îÏñ¥Ïöî."</p>
                    <p class="quote-meta">‚Äî ÌòëÏóÖ Î∏åÎûúÎìú Îã¥ÎãπÏûê ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</p>
                </div>

                <div class="contact-card">
                    <div class="contact-info">
                        <p class="label">CONTACT</p>
                        <h5>Ï†ïÏ§ÄÍ∏∞ Ïù¥ÏÇ¨</h5>
                        <p class="company">ÎîîÏñ¥Îç∞Ïù¥Ï¶à Í≥µÎèôÍµ¨Îß§ ÏóêÏù¥Ï†ÑÏãú</p>
                        <p class="note">010.4343.3685</p>
                    </div>
                    <div class="contact-decoration"></div>
                </div>

                <div class="footer">
                    <p>¬© 2026 DEARDAYS AGENCY | INFLUENCER COLLABORATION PROPOSAL</p>
                </div>
            `;
        }

        // PDF Ï†ÄÏû• (html2canvas + jsPDF)
        async function printProposal() {
            const element = document.getElementById('proposalPreview');
            const btn = document.querySelector('.btn-primary');
            const originalText = btn.textContent;

            btn.textContent = 'PDF ÏÉùÏÑ± Ï§ë...';
            btn.disabled = true;

            // ÏõêÎ≥∏ Ïä§ÌÉÄÏùº Ï†ÄÏû•
            const originalStyle = element.style.cssText;

            // A4 ÌÅ¨Í∏∞Î°ú Í≥†Ï†ï (96dpi Í∏∞Ï§Ä: 210mm=794px, 297mm=1123px)
            element.style.width = '794px';
            element.style.height = '1123px';
            element.style.minHeight = '1123px';
            element.style.overflow = 'visible';

            try {
                const canvas = await html2canvas(element, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#16161c',
                    logging: false,
                    width: 794,
                    height: 1123
                });

                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');

                pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 210, 297);

                const productName = document.getElementById('productName').value || 'proposal';
                const fileName = `Ï†úÏïàÏÑú_${productName}_${new Date().toISOString().slice(0,10)}.pdf`;
                pdf.save(fileName);
            } catch (error) {
                console.error('PDF ÏÉùÏÑ± Ïã§Ìå®:', error);
                alert('PDF ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
            } finally {
                // ÏõêÎ≥∏ Ïä§ÌÉÄÏùº Î≥µÏõê
                element.style.cssText = originalStyle;
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        // HTML Îã§Ïö¥Î°úÎìú
        function downloadHTML() {
            const proposalContent = document.getElementById('proposalPreview').outerHTML;
            const fullHTML = generateFullHTML(proposalContent);

            const blob = new Blob([fullHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `proposal-${Date.now()}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Ï†ÑÏ≤¥ HTML ÏÉùÏÑ±
        function generateFullHTML(content) {
            return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎîîÏñ¥Îç∞Ïù¥Ï¶à ÌòëÏóÖ Ï†úÏïàÏÑú</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Work+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        @page { size: A4; margin: 0; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background: #16161c; }
        .proposal {
            --bg-dark: #16161c;
            --bg-medium: #20202a;
            --card-bg: #26262f;
            --accent-amber: #ffaf5f;
            --accent-gold: #ffd28c;
            --text-white: #faf8f5;
            --text-muted: #8c91a0;
            --coral: #f09b82;
            --teal: #82b4af;
            --purple: #a89bc9;
            --border-radius: 10px;
            width: 210mm; height: 297mm; margin: 0 auto; padding: 35px;
            position: relative; background: linear-gradient(180deg, var(--bg-dark) 0%, var(--bg-medium) 100%);
            color: var(--text-white); overflow: hidden;
        }
        .proposal .top-bar { position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--accent-amber); }
        .proposal .corner-bracket { position: absolute; width: 35px; height: 35px; }
        .proposal .corner-bracket.top-left { top: 25px; left: 28px; border-top: 2px solid var(--accent-gold); border-left: 2px solid var(--accent-gold); }
        .proposal .corner-bracket.top-right { top: 25px; right: 28px; border-top: 2px solid var(--accent-gold); border-right: 2px solid var(--accent-gold); }
        .proposal .corner-bracket.bottom-right { bottom: 25px; right: 28px; border-bottom: 2px solid var(--accent-gold); border-right: 2px solid var(--accent-gold); }
        .proposal .header { display: flex; justify-content: space-between; margin-bottom: 20px; padding-top: 30px; }
        .proposal .header span { font-family: 'Work Sans', sans-serif; font-size: 11px; font-weight: 300; color: var(--text-muted); letter-spacing: 1px; }
        .proposal .title-section { margin-bottom: 25px; }
        .proposal .title-section .accent-line { width: 70px; height: 3px; background: var(--accent-amber); margin-bottom: 15px; }
        .proposal .title-section h1 { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
        .proposal .title-section h2 { font-size: 34px; font-weight: 700; color: var(--accent-amber); margin-bottom: 10px; }
        .proposal .title-section .subtitle { font-family: 'Work Sans', sans-serif; font-size: 11px; font-weight: 400; color: var(--text-muted); letter-spacing: 2px; margin-bottom: 8px; }
        .proposal .title-section .divider { width: 28px; height: 1px; background: var(--text-muted); }
        .proposal .product-card { background: var(--card-bg); border-radius: var(--border-radius); padding: 20px 25px; margin-bottom: 25px; position: relative; }
        .proposal .product-card::before { content: ''; position: absolute; left: 12px; top: 15px; bottom: 15px; width: 3px; background: var(--accent-amber); border-radius: 2px; }
        .proposal .product-info { padding-left: 15px; }
        .proposal .product-info .label { font-family: 'Work Sans', sans-serif; font-size: 10px; color: var(--text-muted); letter-spacing: 1px; margin-bottom: 6px; }
        .proposal .product-info h3 { font-size: 18px; font-weight: 700; margin-bottom: 6px; }
        .proposal .product-info .detail { font-size: 12px; color: var(--accent-gold); margin-bottom: 6px; }
        .proposal .product-info .company { font-size: 11px; color: var(--text-muted); }
        .proposal .section-header { margin-bottom: 14px; }
        .proposal .section-header .line { width: 50px; height: 1px; background: var(--text-muted); margin-bottom: 8px; }
        .proposal .section-header .eng { font-family: 'Work Sans', sans-serif; font-size: 9px; color: var(--text-muted); letter-spacing: 1px; margin-bottom: 3px; }
        .proposal .section-header h4 { font-size: 15px; font-weight: 700; }
        .proposal .influencer-section { margin-bottom: 25px; }
        .proposal .influencer-cards { display: flex; gap: 12px; margin-bottom: 10px; }
        .proposal .influencer-card { flex: 1; background: var(--card-bg); border-radius: var(--border-radius); padding: 14px 12px; display: flex; flex-direction: column; align-items: center; gap: 10px; text-align: center; }
        .proposal .influencer-card .avatar { width: 45px; height: 45px; border-radius: 50%; }
        .proposal .influencer-card .avatar.coral { background: var(--coral); }
        .proposal .influencer-card .avatar.teal { background: var(--teal); }
        .proposal .influencer-card .avatar.purple { background: var(--purple); }
        .proposal .influencer-card .avatar.amber { background: var(--accent-amber); }
        .proposal .influencer-card .info h5 { font-size: 12px; font-weight: 700; margin-bottom: 3px; }
        .proposal .influencer-card .info .handle { font-size: 10px; color: var(--accent-amber); margin-bottom: 3px; }
        .proposal .influencer-card .info .stats { font-size: 9px; color: var(--text-muted); line-height: 1.5; }
        .proposal .influencer-note { font-size: 10px; color: var(--text-muted); }
        .proposal .promise-section { margin-bottom: 25px; }
        .proposal .promise-list { display: flex; flex-direction: column; gap: 10px; }
        .proposal .promise-item { display: flex; align-items: center; gap: 12px; }
        .proposal .promise-item .number { width: 22px; height: 22px; background: var(--accent-amber); border-radius: 5px; display: flex; align-items: center; justify-content: center; font-family: 'Work Sans', sans-serif; font-size: 11px; font-weight: 600; color: var(--bg-dark); }
        .proposal .promise-item .text { font-size: 12px; font-weight: 400; }
        .proposal .agency-section { border-top: 1px solid #32323c; padding-top: 18px; margin-bottom: 22px; }
        .proposal .agency-header { display: flex; align-items: baseline; gap: 12px; margin-bottom: 15px; }
        .proposal .agency-header h4 { font-family: 'Work Sans', sans-serif; font-size: 20px; font-weight: 700; color: var(--accent-amber); }
        .proposal .agency-header span { font-size: 11px; color: var(--text-muted); }
        .proposal .stats { display: flex; gap: 30px; align-items: flex-end; }
        .proposal .stat { flex: 1; }
        .proposal .stat .value { font-family: 'Work Sans', sans-serif; font-size: 22px; font-weight: 700; margin-bottom: 4px; }
        .proposal .stat .label { font-size: 10px; color: var(--text-muted); }
        .proposal .stat.website .value { font-size: 12px; color: var(--accent-amber); }
        .proposal .contact-card { background: var(--card-bg); border-radius: var(--border-radius); padding: 16px 22px; display: flex; justify-content: space-between; align-items: center; position: relative; margin-bottom: 18px; }
        .proposal .contact-card::before { content: ''; position: absolute; left: 12px; top: 12px; bottom: 12px; width: 3px; background: var(--accent-amber); border-radius: 2px; }
        .proposal .contact-info { padding-left: 14px; }
        .proposal .contact-info .label { font-family: 'Work Sans', sans-serif; font-size: 9px; color: var(--text-muted); letter-spacing: 1px; margin-bottom: 5px; }
        .proposal .contact-info h5 { font-size: 15px; font-weight: 700; margin-bottom: 5px; }
        .proposal .contact-info .company { font-size: 11px; color: var(--accent-gold); margin-bottom: 3px; }
        .proposal .contact-info .note { font-size: 10px; color: var(--text-muted); }
        .proposal .contact-decoration { width: 50px; height: 50px; border: 2px solid var(--accent-amber); border-radius: 4px; position: relative; }
        .proposal .contact-decoration::after { content: ''; position: absolute; top: 6px; left: 6px; right: 6px; bottom: 6px; border: 1px solid var(--accent-gold); border-radius: 2px; }
        .proposal .footer { border-top: 2px solid var(--accent-amber); padding-top: 12px; text-align: center; }
        .proposal .footer p { font-family: 'Work Sans', sans-serif; font-size: 9px; color: var(--text-muted); letter-spacing: 1px; }
        @media print { html, body { width: 210mm; height: 297mm; } body { -webkit-print-color-adjust: exact; print-color-adjust: exact; } .proposal { margin: 0; } }
    </style>
</head>
<body>
    ${content}
</body>
</html>`;
        }

        // ============ Ïù¥Î©îÏùº ÏÉùÏÑ± ============
        function generateEmail() {
            const productName = document.getElementById('productName').value || '[Ï†úÌíàÎ™Ö]';
            const companyName = document.getElementById('companyName').value || '[ÌöåÏÇ¨Î™Ö]';

            // Ï†úÎ™© ÏÉùÏÑ±
            const subject = `[${companyName} x ÎîîÏñ¥Îç∞Ïù¥Ï¶à] Í≥µÎèôÍµ¨Îß§ Ï†úÏïà ${productName}`;

            // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Î™©Î°ù ÏÉùÏÑ±
            let influencerSection = '';
            influencers.forEach((inf, index) => {
                if (inf.name || inf.handle) {
                    const name = inf.name || '[Ïù¥Î¶Ñ]';
                    const handle = inf.handle || '@handle';
                    const followers = inf.followers || '-';
                    const avgViews = inf.avgViews || '-';
                    const instagramUrl = handle.startsWith('@')
                        ? `https://www.instagram.com/${handle.substring(1)}/`
                        : `https://www.instagram.com/${handle}/`;

                    const category = inf.category || 'ÏÇ¥Î¶º';
                    influencerSection += `
${index + 1}. ${handle.replace('@', '')} | ${name} ${followers} ${instagramUrl}
‚Ä¢ ${category} Ïπ¥ÌÖåÍ≥†Î¶¨
‚Ä¢ Í≥µÍµ¨Ï†úÌíà ÌôúÏö©Ìïú ÏΩòÌÖêÏ∏†Ïùò Î¶¥Ïä§ Ï°∞ÌöåÏàò(ÌèâÍ∑† ${avgViews})

`;
                }
            });

            // Î≥∏Î¨∏ ÏÉùÏÑ±
            const body = `ÏïàÎÖïÌïòÏÑ∏Ïöî, ${companyName} Îã¥ÎãπÏûêÎãò.

Í≥µÎèôÍµ¨Îß§ Ï†ÑÎ¨∏ ÏóêÏù¥Ï†ÑÏãú ÎîîÏñ¥Îç∞Ïù¥Ï¶àÏùò Ï†ïÏ§ÄÍ∏∞ Ïù¥ÏÇ¨ÏûÖÎãàÎã§.

${companyName}Ïùò „Äå${productName}„Äç Ï†úÌíàÏùÑ Î≥¥Í≥† Ïó∞ÎùΩÎìúÎ¶ΩÎãàÎã§.
Ï¢ãÏùÄ Ï†úÌíàÏùÑ ÌåêÎß§ÌïòÍ≥† Í≥ÑÏÖîÏÑú Í≥µÎèôÍµ¨Îß§ ÌîÑÎ°úÎ™®ÏÖòÏùÑ Ìï®Íªò ÏßÑÌñâÌïòÍ≥† Ïã∂ÏäµÎãàÎã§.

Ï†ÄÌù¨Í∞Ä ÌòëÏóÖ Ï§ëÏù∏ Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Î∂ÑÎì§ Ï§ë ${productName} Ï†úÌíàÍ≥º ÌïèÏù¥ ÎßûÎäî Î∂ÑÎì§Ïù¥ Í≥ÑÏÖî Í≥µÎèôÍµ¨Îß§Î•º Ï†úÏïàÎìúÎ¶ΩÎãàÎã§.
Í≥µÍµ¨ ÌåêÎß§Ïã§Ï†Å, Î¶¥Ïä§ Ï°∞ÌöåÏàò, ÌåîÎ°úÏõå ÏÜåÌÜµ, Ï∞∏Ïó¨Ïú® Ïô∏ ÎÇ¥Î∂Ä Í≤ÄÌÜ† ÌîÑÎ°úÏÑ∏Ïä§Î•º Í±∞Ï≥ê Îß§Ïπ≠ÌïòÏòÄÏäµÎãàÎã§.

${influencerSection}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

‚ñ† ÎîîÏñ¥Îç∞Ïù¥Ï¶à ÏÜåÍ∞ú

Ï†ÄÌù¨Îäî 400Í±¥ Ïù¥ÏÉÅÏùò Í≥µÎèôÍµ¨Îß§Î•º ÏßÑÌñâÌïòÎ©∞ 98% Í≥†Í∞ù ÎßåÏ°±ÎèÑÎ•º Îã¨ÏÑ±Ìïú
50Í∞ú Î∏åÎûúÎìúÏùò Ïã†Î¢∞Î∞õÎäî ÌååÌä∏ÎÑàÏûÖÎãàÎã§.

‚Ä¢ 300Î™Ö Ïù¥ÏÉÅÏùò Í≤ÄÏ¶ùÎêú Ïù∏ÌîåÎ£®Ïñ∏ÏÑúÏôÄ ÏßÅÏ†ë ÌòëÏóÖ
‚Ä¢ ÏΩòÌÖêÏ∏† Í∏∞ÌöçÎ∂ÄÌÑ∞ ÌåêÎß§ Ïö¥ÏòÅÍπåÏßÄ ÏõêÏä§ÌÜ± ÏßÑÌñâ
‚Ä¢ Îç∞Ïù¥ÌÑ∞ Í∏∞Î∞ò Îß§Ïπ≠ÏúºÎ°ú ÏµúÏ†ÅÏùò Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ïó∞Í≥Ñ
‚Ä¢ Î∏åÎûúÎìúÎ≥Ñ ÎßûÏ∂§ Ï†ÑÎûµÏúºÎ°ú Î™©Ìëú Îß§Ï∂úÍ≥º Ïû•Í∏∞ Í≥†Í∞ù ÌôïÎ≥¥

‚ñ∏ ÏÑ±Í≥µ ÏÇ¨Î°Ä
  - ÌÇ§Ïπú Î∏åÎûúÎìú: Ïù∏ÏßÄÎèÑ Ï†úÎ°úÏóêÏÑú 5Ï∞® Í≥µÍµ¨ Ïó∞ÏÜç ÏôÑÌåê
  - ÏãùÌíà Î∏åÎûúÎìú: Î°†Ïπ≠ 6ÏãúÍ∞Ñ ÎßåÏóê Ï†ÑÎüâ ÏÜåÏßÑ
  - ÎùºÏù¥ÌîÑÏä§ÌÉÄÏùº Î∏åÎûúÎìú: Ïã†Í∑ú Í≥†Í∞ù Ïú†ÏûÖ 300% Ï¶ùÍ∞Ä

‚ñ∏ Í≥†Í∞ù ÎßåÏ°±ÎèÑ ÌîºÎìúÎ∞±
  "Í≥µÍµ¨Î°ú Î∞îÏù¥Îü¥Ïù¥ Ïûò ÎêòÏñ¥ÏÑú Ï†ÄÌù¨Ï™Ω Î∏åÎûúÎìú Ïù∏ÏßÄÎèÑÍ∞Ä ÎßéÏù¥ Ïò¨ÎùºÍ∞îÏñ¥Ïöî."
  "Ï†ÄÌù¨Ï™Ω Î∏åÎûúÎìúÏôÄ Ïûò ÎßûÎäî ÏÖÄÎü¨Î∂ÑÏùÑ Îß§Ïπ≠Ìï¥Ï£ºÏÖ®Ïñ¥Ïöî."
  "ÏïûÏúºÎ°ú ÏûêÏ£º Í±∞ÎûòÌïòÍ≥† Ïã∂Ïñ¥Ïöî. ÌäπÌûà Îã¥Îãπ Ïù¥ÏÇ¨ÎãòÏù¥ ÎÑàÎ¨¥ ÏûòÌï¥Ï£ºÏÖ®Ïñ¥Ïöî."

Ï†ÄÌù¨Ïùò Î™©ÌëúÎäî Îã®Ïàú Îß§Ï∂ú ÏÉÅÏäπÏù¥ ÏïÑÎãàÎùº,
Í≥µÎèôÍµ¨Îß§Î•º ÌÜµÌï¥ Î∏åÎûúÎìúÍ∞Ä Í≥†Í∞ùÏóêÍ≤å Í∏∞ÏñµÎêòÎèÑÎ°ù ÎèïÎäî Í≤ÉÏûÖÎãàÎã§.

Í∏çÏ†ïÏ†ÅÏù∏ Í≤ÄÌÜ† Î∂ÄÌÉÅÎìúÎ¶¨Î©∞,
Ìé∏ÌïòÏã† ÏãúÍ∞ÑÎåÄÏóê Ïó∞ÎùΩÏ£ºÏãúÎ©¥ Î∞îÎ°ú ÎãµÎ≥ÄÎìúÎ¶¥ Ïàò ÏûàÎèÑÎ°ù ÌïòÍ≤†ÏäµÎãàÎã§.

Í∞êÏÇ¨Ìï©ÎãàÎã§.
Ï†ïÏ§ÄÍ∏∞ ÎìúÎ¶º`;

            document.getElementById('emailSubject').value = subject;
            document.getElementById('emailBody').value = body;
            document.getElementById('emailModal').classList.add('show');
        }

        function closeEmailModal() {
            document.getElementById('emailModal').classList.remove('show');
        }

        function copyEmail() {
            const subject = document.getElementById('emailSubject').value;
            const body = document.getElementById('emailBody').value;
            const fullEmail = `Ï†úÎ™©: ${subject}\n\n${body}`;

            navigator.clipboard.writeText(fullEmail).then(() => {
                const btn = document.querySelector('.copy-btn');
                btn.textContent = 'Î≥µÏÇ¨Îê®!';
                setTimeout(() => btn.textContent = 'Ï†ÑÏ≤¥ Î≥µÏÇ¨', 2000);
            });
        }

        // ============ Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Î∏åÎùºÏö∞Ï†Ä ============
        let browserSelectedInfluencers = [];
        let searchDebounceTimer = null;
        let currentSearchCursor = null;
        let isLoadingMore = false;

        // Ï∫êÏãú: Ï†ÑÏ≤¥ Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Î™©Î°ù (Î©îÎ™®Î¶¨ Ï†ÄÏû•)
        let influencerCache = [];
        let cacheLoaded = false;
        let cacheLoadingPromise = null;

        // Ï†ÑÏ≤¥ Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Î°úÎìú (Ï∫êÏãúÏö©)
        async function loadAllInfluencersToCache() {
            if (cacheLoaded) return influencerCache;
            if (cacheLoadingPromise) return cacheLoadingPromise;

            cacheLoadingPromise = (async () => {
                let allResults = [];
                let cursor = null;
                let hasMore = true;

                while (hasMore) {
                    const response = await fetch(NOTION_PROXY_URL + '/list', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            databaseId: NOTION_DATABASE_ID,
                            filters: {},
                            sort: 'avgViews',
                            cursor: cursor,
                            limit: 100
                        })
                    });

                    const data = await response.json();
                    if (data.error) throw new Error(data.error);

                    allResults = allResults.concat(data.results || []);
                    cursor = data.nextCursor;
                    hasMore = data.hasMore;
                }

                influencerCache = allResults;
                cacheLoaded = true;
                cacheLoadingPromise = null;
                console.log(`Ï∫êÏãú Î°úÎìú ÏôÑÎ£å: ${allResults.length}Î™Ö`);

                // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞ ÎèôÏ†Å ÏÉùÏÑ±
                updateCategoryFilter();

                return allResults;
            })();

            return cacheLoadingPromise;
        }

        // Ï∫êÏãú ÏÉàÎ°úÍ≥†Ïπ®
        async function refreshCache() {
            cacheLoaded = false;
            influencerCache = [];
            await loadAllInfluencersToCache();
            updateCategoryFilter();
            applyFilters();
        }

        // Ï∫êÏãúÏóêÏÑú Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù Ï∂îÏ∂ú Î∞è ÌïÑÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCategoryFilter() {
            const categorySet = new Set();
            influencerCache.forEach(inf => {
                if (inf.categoryMain) {
                    inf.categoryMain.forEach(cat => categorySet.add(cat));
                }
            });

            const categories = Array.from(categorySet).sort();
            const filterMenu = document.getElementById('categoryFilter');

            if (categories.length === 0) {
                filterMenu.innerHTML = '<div style="padding: 8px 14px; color: #8c91a0; font-size: 11px;">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏóÜÏùå</div>';
                return;
            }

            filterMenu.innerHTML = categories.map(cat => `
                <label><input type="checkbox" value="${cat}" onchange="applyFilters()"> ${cat}</label>
            `).join('');
        }

        // ÏÉÅÌÉú Ï†ÄÏû•/Î≥µÏõê ÌÇ§
        const BROWSER_STATE_KEY = 'influencerBrowserState';

        function saveBrowserState() {
            const state = {
                isOpen: document.getElementById('influencerBrowserModal').classList.contains('show'),
                selected: browserSelectedInfluencers,
                cache: influencerCache,
                cacheLoaded: cacheLoaded
            };
            localStorage.setItem(BROWSER_STATE_KEY, JSON.stringify(state));
        }

        function restoreBrowserState() {
            try {
                const saved = localStorage.getItem(BROWSER_STATE_KEY);
                if (!saved) return;

                const state = JSON.parse(saved);

                // Ï∫êÏãú Î≥µÏõê
                if (state.cache && state.cache.length > 0) {
                    influencerCache = state.cache;
                    cacheLoaded = state.cacheLoaded;
                }

                // Î™®Îã¨Ïù¥ Ïó¥Î†§ÏûàÏóàÏúºÎ©¥ Î≥µÏõê
                if (state.isOpen) {
                    document.getElementById('influencerBrowserModal').classList.add('show');
                    document.body.style.overflow = 'hidden';
                    document.body.style.position = 'fixed';
                    document.body.style.width = '100%';
                    document.body.style.top = '0px';
                    browserSelectedInfluencers = state.selected || [];
                    updateSelectedList();
                    loadInfluencers();
                    updateCategoryFilter();
                }
            } catch (e) {
                console.error('ÏÉÅÌÉú Î≥µÏõê Ïã§Ìå®:', e);
                localStorage.removeItem(BROWSER_STATE_KEY);
            }
        }

        function openInfluencerBrowser() {
            const modal = document.getElementById('influencerBrowserModal');
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
            document.body.style.position = 'fixed';
            document.body.style.width = '100%';
            document.body.style.top = `-${window.scrollY}px`;
            browserSelectedInfluencers = [];
            updateSelectedList();
            saveBrowserState();
            // Ï¥àÍ∏∞ Î°úÎìú
            loadInfluencers();
        }

        function closeInfluencerBrowser() {
            const modal = document.getElementById('influencerBrowserModal');
            modal.classList.remove('show');
            const scrollY = document.body.style.top;
            document.body.style.overflow = '';
            document.body.style.position = '';
            document.body.style.width = '';
            document.body.style.top = '';
            window.scrollTo(0, parseInt(scrollY || '0') * -1);
            // ÏÉÅÌÉú Ï¥àÍ∏∞Ìôî
            localStorage.removeItem(BROWSER_STATE_KEY);
        }

        function toggleFilterMenu(menuId) {
            const menu = document.getElementById(menuId);
            const allMenus = document.querySelectorAll('.filter-menu');
            allMenus.forEach(m => {
                if (m.id !== menuId) m.classList.remove('show');
            });
            menu.classList.toggle('show');
        }

        // ÌÅ¥Î¶≠ Ïô∏Î∂Ä ÏòÅÏó≠ ÌÅ¥Î¶≠ Ïãú ÌïÑÌÑ∞ Î©îÎâ¥ Îã´Í∏∞
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.filter-dropdown')) {
                document.querySelectorAll('.filter-menu').forEach(m => m.classList.remove('show'));
            }
        });

        function debounceSearch() {
            clearTimeout(searchDebounceTimer);
            searchDebounceTimer = setTimeout(() => {
                applyFilters();
            }, 300);
        }

        function getFilters() {
            const search = document.getElementById('browserSearchInput').value.trim();

            // Ïπ¥ÌÖåÍ≥†Î¶¨ (Îã§Ï§ë ÏÑ†ÌÉù)
            const categories = [];
            document.querySelectorAll('#categoryFilter input:checked').forEach(cb => {
                categories.push(cb.value);
            });

            // ÌåîÎ°úÏõå (Îã®Ïùº ÏÑ†ÌÉù)
            const followerRadio = document.querySelector('input[name="follower"]:checked');
            const minFollowers = followerRadio ? parseInt(followerRadio.value) : 0;

            // Ï°∞ÌöåÏàò (Îã®Ïùº ÏÑ†ÌÉù)
            const viewsRadio = document.querySelector('input[name="views"]:checked');
            const minAvgViews = viewsRadio ? parseInt(viewsRadio.value) : 0;

            // Ï†ïÎ†¨
            const sort = document.getElementById('sortSelect').value;

            // ÌïÑÌÑ∞ Î≤ÑÌäº ÌôúÏÑ± ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.getElementById('categoryFilterBtn').classList.toggle('active', categories.length > 0);
            document.getElementById('followerFilterBtn').classList.toggle('active', minFollowers > 0);
            document.getElementById('viewsFilterBtn').classList.toggle('active', minAvgViews > 0);

            return { search, categories, minFollowers, minAvgViews, sort };
        }

        function applyFilters() {
            currentSearchCursor = null;
            loadInfluencers();
        }

        async function loadInfluencers(append = false) {
            const resultsContainer = document.getElementById('browserResults');

            if (!append) {
                resultsContainer.innerHTML = '<div class="results-loading">Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§Îäî Ï§ë...</div>';
            }

            const filters = getFilters();

            try {
                // Ï∫êÏãúÏóêÏÑú Î∂àÎü¨Ïò§Í∏∞ (Ï≤´ Î°úÎìú Ïãú API Ìò∏Ï∂ú)
                const allInfluencers = await loadAllInfluencersToCache();

                // ÌÅ¥ÎùºÏù¥Ïñ∏Ìä∏ Ï∏° ÌïÑÌÑ∞ÎßÅ
                let results = [...allInfluencers];

                // Í≤ÄÏÉâÏñ¥ ÌïÑÌÑ∞
                if (filters.search) {
                    const searchLower = filters.search.toLowerCase();
                    results = results.filter(inf =>
                        inf.name?.toLowerCase().includes(searchLower) ||
                        inf.influencerId?.toLowerCase().includes(searchLower) ||
                        inf.handle?.toLowerCase().includes(searchLower) ||
                        inf.categoryMain?.some(cat => cat.toLowerCase().includes(searchLower))
                    );
                }

                // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌïÑÌÑ∞
                if (filters.categories.length > 0) {
                    results = results.filter(inf =>
                        inf.categoryMain?.some(cat => filters.categories.includes(cat))
                    );
                }

                // ÌåîÎ°úÏõå ÌïÑÌÑ∞
                if (filters.minFollowers > 0) {
                    const minInMan = filters.minFollowers / 10000;
                    results = results.filter(inf => {
                        const val = parseFloat(inf.followers) || 0;
                        return val >= minInMan;
                    });
                }

                // Ï°∞ÌöåÏàò ÌïÑÌÑ∞
                if (filters.minAvgViews > 0) {
                    const minInMan = filters.minAvgViews / 10000;
                    results = results.filter(inf => {
                        const val = parseFloat(inf.avgViews) || 0;
                        return val >= minInMan;
                    });
                }

                // Ï†ïÎ†¨
                results.sort((a, b) => {
                    if (filters.sort === 'avgViews') {
                        return (parseFloat(b.avgViews) || 0) - (parseFloat(a.avgViews) || 0);
                    } else if (filters.sort === 'followers') {
                        return (parseFloat(b.followers) || 0) - (parseFloat(a.followers) || 0);
                    } else {
                        return (a.name || '').localeCompare(b.name || '');
                    }
                });

                // Í≤∞Í≥º ÌëúÏãú
                if (results.length === 0) {
                    resultsContainer.innerHTML = '<div class="results-empty">Í≤ÄÏÉâ Í≤∞Í≥ºÍ∞Ä ÏóÜÏäµÎãàÎã§</div>';
                    return;
                }

                resultsContainer.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <span style="font-size: 12px; color: #8c91a0;">${results.length}Î™ÖÏùò Ïù∏ÌîåÎ£®Ïñ∏ÏÑú</span>
                        <button onclick="refreshCache()" style="padding: 6px 12px; background: #32323c; border: none; border-radius: 4px; color: #8c91a0; font-size: 11px; cursor: pointer;">üîÑ ÏÉàÎ°úÍ≥†Ïπ®</button>
                    </div>
                    <div class="results-grid" id="resultsGrid"></div>
                `;

                const grid = document.getElementById('resultsGrid');
                results.forEach(inf => {
                    grid.appendChild(createResultCard(inf));
                });

            } catch (error) {
                console.error('Load influencers error:', error);
                resultsContainer.innerHTML = `<div class="results-empty">Ïò§Î•ò Î∞úÏÉù: ${error.message}</div>`;
            }
        }

        function createResultCard(inf) {
            const isSelected = browserSelectedInfluencers.some(s => s.id === inf.id);
            const card = document.createElement('div');
            card.className = `result-card ${isSelected ? 'selected' : ''}`;
            card.dataset.id = inf.id;

            const followers = inf.followers ? inf.followers + 'Îßå' : '-';
            const avgViews = inf.avgViews ? inf.avgViews + 'Îßå' : '-';
            const category = inf.categoryMain?.join(' ¬∑ ') || '-';
            const displayName = inf.name.split('„Ö£')[0].trim();

            card.innerHTML = `
                <div class="card-name">${displayName}</div>
                <div class="card-handle">${inf.handle}</div>
                <div class="card-stats">
                    <div class="stat-item">
                        <span class="stat-value">${followers}</span>
                        <span class="stat-label">ÌåîÎ°úÏõå</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${avgViews}</span>
                        <span class="stat-label">Î¶¥Ïä§ ÌèâÍ∑†</span>
                    </div>
                </div>
                <div class="card-category">üè∑Ô∏è ${category}</div>
                <div class="card-actions">
                    <button class="btn-instagram" onclick="event.stopPropagation(); openInstagram('${inf.instagramUrl || ''}', '${inf.influencerId}')">Ïù∏Ïä§ÌÉÄ Ïó¥Í∏∞</button>
                    <button class="btn-select" onclick="event.stopPropagation(); toggleSelectInfluencer('${inf.id}')">${isSelected ? '‚úì ÏÑ†ÌÉùÎê®' : '+ ÏÑ†ÌÉù'}</button>
                </div>
            `;

            // Ïπ¥Îìú Ï†ÑÏ≤¥ ÌÅ¥Î¶≠ÏúºÎ°ú ÏÑ†ÌÉù/Ìï¥Ï†ú
            card.addEventListener('click', () => toggleSelectInfluencer(inf.id, inf));

            // Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
            card._data = inf;

            return card;
        }

        function openInstagram(url, handle) {
            let targetUrl = url || `https://www.instagram.com/${handle}/`;
            // ÎÅùÏùò / Ï†úÍ±∞ ÌõÑ ?auto=notion Ï∂îÍ∞Ä
            targetUrl = targetUrl.replace(/\/+$/, '') + '?auto=notion';
            window.open(targetUrl, '_blank');
        }

        function toggleSelectInfluencer(id, data) {
            const existingIndex = browserSelectedInfluencers.findIndex(s => s.id === id);

            if (existingIndex >= 0) {
                // ÏÑ†ÌÉù Ìï¥Ï†ú
                browserSelectedInfluencers.splice(existingIndex, 1);
            } else {
                // ÏÑ†ÌÉù Ï∂îÍ∞Ä (ÏµúÎåÄ 5Î™Ö)
                if (browserSelectedInfluencers.length >= 5) {
                    alert('ÏµúÎåÄ 5Î™ÖÍπåÏßÄ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                    return;
                }

                // Îç∞Ïù¥ÌÑ∞ Ï∞æÍ∏∞
                if (!data) {
                    const card = document.querySelector(`.result-card[data-id="${id}"]`);
                    if (card && card._data) {
                        data = card._data;
                    }
                }

                if (data) {
                    browserSelectedInfluencers.push({
                        ...data,
                        memo: data.memo || ''
                    });
                }
            }

            updateResultCardsSelection();
            updateSelectedList();
            saveBrowserState();
        }

        function updateResultCardsSelection() {
            document.querySelectorAll('.result-card').forEach(card => {
                const id = card.dataset.id;
                const isSelected = browserSelectedInfluencers.some(s => s.id === id);
                card.classList.toggle('selected', isSelected);
                const btn = card.querySelector('.btn-select');
                if (btn) {
                    btn.textContent = isSelected ? '‚úì ÏÑ†ÌÉùÎê®' : '+ ÏÑ†ÌÉù';
                }
            });
        }

        function updateSelectedList() {
            const container = document.getElementById('selectedList');
            const countSpan = document.getElementById('selectedCount');
            const addBtn = document.getElementById('addToProposalBtn');

            countSpan.textContent = `(${browserSelectedInfluencers.length}/5)`;
            addBtn.disabled = browserSelectedInfluencers.length === 0;

            if (browserSelectedInfluencers.length === 0) {
                container.innerHTML = '<div class="results-empty" style="padding: 40px 20px;">Ïù∏ÌîåÎ£®Ïñ∏ÏÑúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>';
                return;
            }

            container.innerHTML = browserSelectedInfluencers.map((inf, index) => {
                const displayName = inf.name.split('„Ö£')[0].trim();

                return `
                    <div class="selected-item" data-id="${inf.id}">
                        <div class="selected-item-header">
                            <div class="selected-item-info">
                                <h5>${displayName}</h5>
                                <span>${inf.handle}</span>
                            </div>
                            <button class="selected-item-remove" onclick="toggleSelectInfluencer('${inf.id}')">&times;</button>
                        </div>
                        <textarea class="memo-input" placeholder="Î©îÎ™® (Ïòà: ÏÇ¥Î¶º ÏΩòÌÖêÏ∏† ÌÄÑÎ¶¨Ìã∞ Ï¢ãÏùå)"
                                  onchange="updateMemo('${inf.id}', this.value)">${inf.memo || ''}</textarea>
                        <button class="memo-save-btn" onclick="saveMemoToNotion('${inf.id}')" id="memoBtn_${inf.id}">
                            NotionÏóê Ï†ÄÏû•
                        </button>
                    </div>
                `;
            }).join('');
        }

        function updateMemo(infId, value) {
            const inf = browserSelectedInfluencers.find(s => s.id === infId);
            if (inf) {
                inf.memo = value;
            }
        }

        async function saveMemoToNotion(infId) {
            const inf = browserSelectedInfluencers.find(s => s.id === infId);
            if (!inf) return;

            const btn = document.getElementById(`memoBtn_${infId}`);
            btn.disabled = true;
            btn.textContent = 'Ï†ÄÏû• Ï§ë...';

            try {
                const response = await fetch(NOTION_PROXY_URL + '/update-memo', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        pageId: inf.id,
                        memo: inf.memo
                    })
                });

                const data = await response.json();

                if (data.success) {
                    btn.textContent = 'Ï†ÄÏû•Îê® ‚úì';
                    btn.classList.add('saved');
                    setTimeout(() => {
                        btn.textContent = 'NotionÏóê Ï†ÄÏû•';
                        btn.classList.remove('saved');
                        btn.disabled = false;
                    }, 2000);
                } else {
                    throw new Error(data.error || 'Ï†ÄÏû• Ïã§Ìå®');
                }
            } catch (error) {
                console.error('Save memo error:', error);
                btn.textContent = 'Ï†ÄÏû• Ïã§Ìå®';
                btn.disabled = false;
                setTimeout(() => {
                    btn.textContent = 'NotionÏóê Ï†ÄÏû•';
                }, 2000);

                // Notion DBÏóê 'Î©îÎ™®' ÏÜçÏÑ±Ïù¥ ÏóÜÏùÑ Ïàò ÏûàÏùå
                if (error.message.includes('property')) {
                    alert('Notion Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§Ïóê "Î©îÎ™®" ÏÜçÏÑ±(rich_text)ÏùÑ Ï∂îÍ∞ÄÌï¥Ï£ºÏÑ∏Ïöî.');
                }
            }
        }

        function addSelectedToProposal() {
            // Í∏∞Ï°¥ Îπà Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ï†úÍ±∞
            influencers = influencers.filter(inf => inf.name || inf.handle);

            // ÏÑ†ÌÉùÎêú Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ï∂îÍ∞Ä
            browserSelectedInfluencers.forEach(inf => {
                const displayName = inf.name.split('„Ö£')[0].trim();
                const followers = inf.followers ? inf.followers + 'Îßå' : '';
                const avgViews = inf.avgViews ? inf.avgViews + 'Îßå' : '';

                influencers.push({
                    id: influencerIdCounter++,
                    name: displayName,
                    handle: inf.handle || '@' + inf.influencerId,
                    followers: followers,
                    avgViews: avgViews,
                    category: inf.categoryMain?.join('¬∑') || '',
                    notionPageId: inf.id  // Notion ÌéòÏù¥ÏßÄ ID Ï†ÄÏû• (Ï†úÏïàÏÑú Ï†ÄÏû•Ïö©)
                });
            });

            // ÏµúÏÜå 1Í∞ú Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Ïú†ÏßÄ
            if (influencers.length === 0) {
                addInfluencer();
            }

            renderInfluencerList();
            updatePreview();
            closeInfluencerBrowser();
        }

        function setupInfiniteScroll() {
            const resultsContainer = document.getElementById('browserResults');

            resultsContainer.onscroll = () => {
                if (isLoadingMore) return;

                const { scrollTop, scrollHeight, clientHeight } = resultsContainer;
                if (scrollTop + clientHeight >= scrollHeight - 100) {
                    if (currentSearchCursor) {
                        isLoadingMore = true;
                        loadInfluencers(true).then(() => {
                            isLoadingMore = false;
                        });
                    }
                }
            };
        }

        // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                // Ïù∏ÌîåÎ£®Ïñ∏ÏÑú Î∏åÎùºÏö∞Ï†Ä
                if (document.getElementById('influencerBrowserModal')?.classList.contains('show')) {
                    closeInfluencerBrowser();
                }
                // Ï†úÌíà Î∏åÎùºÏö∞Ï†Ä
                if (document.getElementById('productBrowserModal')?.classList.contains('show')) {
                    closeProductBrowser();
                }
                // Ï†úÏïàÏÑú Î∏åÎùºÏö∞Ï†Ä
                if (document.getElementById('proposalBrowserModal')?.classList.contains('show')) {
                    closeProposalBrowser();
                }
                // Ïù¥Î©îÏùº Î™®Îã¨
                if (document.getElementById('emailModal')?.classList.contains('show')) {
                    closeEmailModal();
                }
            }
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        window.onload = async function() {
            init();
            restoreBrowserState();

            // URL ÌååÎùºÎØ∏ÌÑ∞ ÌôïÏù∏
            const params = getUrlParams();

            // Ï†úÌíà IDÍ∞Ä ÏûàÏúºÎ©¥ ÏûêÎèô Î°úÎìú
            if (params.productId) {
                await loadProductFromNotion(params.productId);
            }
        };
    </script>
</body>
</html>
